<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª - Ù†Ø¸Ø§Ù… Ø§Ù„Ù‡ÙˆÙŠØ© Ø§Ù„Ø±Ù‚Ù…ÙŠØ©</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="firebase-config.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Cairo', sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .header {
            background: linear-gradient(135deg, #0D98BA, #00ac75);
            color: white;
            padding: 30px 20px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 16px;
        }
        
        .container {
            max-width: 1200px;
            margin: 30px auto;
            padding: 0 20px;
        }
        
        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            text-align: center;
            transition: transform 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-card i {
            font-size: 40px;
            margin-bottom: 15px;
        }
        
        .stat-card .number {
            font-size: 36px;
            font-weight: 700;
            color: #0D98BA;
            margin: 10px 0;
        }
        
        .stat-card .label {
            color: #666;
            font-size: 14px;
        }
        
        .controls {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        }
        
        .filters {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .filter-group {
            flex: 1;
            min-width: 200px;
        }
        
        .filter-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 600;
        }
        
        .filter-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e5eb;
            border-radius: 8px;
            font-size: 14px;
            transition: border 0.3s;
        }
        
        .filter-input:focus {
            border-color: #00ac75;
            outline: none;
        }
        
        .buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background-color: #00ac75;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #009966;
        }
        
        .btn-secondary {
            background-color: #78849e;
            color: white;
        }
        
        .btn-secondary:hover {
            background-color: #5a657e;
        }
        
        .btn-danger {
            background-color: #ff4757;
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #ff3742;
        }
        
        /* ØªÙ†Ø³ÙŠÙ‚ Ù‚Ø³Ù… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±Ù‚Ù… */
        .add-number-section {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e1e5eb;
            border-left: 4px solid #0D98BA !important;
            transition: all 0.3s ease;
        }
        
        .add-number-section:hover {
            box-shadow: 0 4px 12px rgba(13, 152, 186, 0.15);
        }
        
        .add-number-section input[type="number"] {
            font-size: 24px;
            font-weight: 700;
            letter-spacing: 2px;
            text-align: center;
            height: 60px;
        }
        
        .add-number-section .btn-primary {
            background: linear-gradient(135deg, #0D98BA, #00ac75);
            border: none;
            font-weight: 600;
            transition: all 0.3s;
            height: 60px;
            font-size: 16px;
        }
        
        .add-number-section .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(13, 152, 186, 0.3);
        }
        
        /* ØªÙ†Ø³ÙŠÙ‚ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„Ø© */
        #numberStatus {
            animation: fadeIn 0.5s ease;
            margin-top: 10px;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* ØªÙ†Ø³ÙŠÙ‚ Ø¹Ø±Ø¶ Ø§Ù„Ø±Ù‚Ù… */
        .number-preview {
            background: white;
            border: 2px dashed #0D98BA;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            margin-top: 15px;
            font-size: 28px;
            font-weight: bold;
            color: #0D98BA;
            display: none;
        }
        
        .number-preview.show {
            display: block;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .data-table-container {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            margin-bottom: 30px;
        }
        
        .table-header {
            padding: 20px;
            background-color: #f8fafc;
            border-bottom: 2px solid #e1e5eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .table-header h2 {
            color: #333;
            font-size: 20px;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .data-table th {
            background-color: #f1f5f9;
            padding: 15px;
            text-align: right;
            font-weight: 600;
            color: #454f63;
            border-bottom: 2px solid #e1e5eb;
            position: sticky;
            top: 0;
        }
        
        .data-table td {
            padding: 15px;
            border-bottom: 1px solid #eef2f7;
            color: #555;
        }
        
        .data-table tr:hover {
            background-color: #f8fafc;
        }
        
        .id-number {
            font-family: monospace;
            font-size: 16px;
            color: #0D98BA;
            font-weight: 600;
        }
        
        .timestamp {
            font-size: 13px;
            color: #78849e;
        }
        
        .status {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .status-success {
            background-color: #d4edda;
            color: #155724;
        }
        
        .status-warning {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .sync-status {
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
            margin-right: 5px;
        }
        
        .sync-synced {
            background-color: #d4edda;
            color: #155724;
        }
        
        .sync-pending {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .sync-failed {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .no-data {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }
        
        .no-data i {
            font-size: 60px;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        
        .pagination {
            display: flex;
            justify-content: center;
            gap: 10px;
            padding: 20px;
            background-color: #f8fafc;
        }
        
        .page-btn {
            padding: 8px 15px;
            border: 1px solid #e1e5eb;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .page-btn:hover {
            background-color: #00ac75;
            color: white;
            border-color: #00ac75;
        }
        
        .page-btn.active {
            background-color: #00ac75;
            color: white;
            border-color: #00ac75;
        }
        
        .footer {
            text-align: center;
            padding: 20px;
            color: #78849e;
            font-size: 14px;
            border-top: 1px solid #e1e5eb;
            margin-top: 30px;
        }
        
        /* Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª */
        .firebase-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #00ac75;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 9999;
            animation: slideIn 0.3s ease;
            max-width: 300px;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        
        @media (max-width: 768px) {
            .data-table {
                display: block;
                overflow-x: auto;
            }
            
            .stats-cards {
                grid-template-columns: 1fr;
            }
            
            .filters {
                flex-direction: column;
            }
            
            .buttons {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
            
            .add-number-section .row {
                flex-direction: column;
            }
            
            .add-number-section .col-md-2 {
                width: 100%;
            }
            
            .add-number-section input[type="number"] {
                font-size: 20px;
                height: 50px;
            }
            
            .add-number-section .btn-primary {
                height: 50px;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <header class="header">
        <h1>ğŸ“Š Ù„ÙˆØ­Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª - Ù…ØªØµÙ„Ø© Ø¨Ù€ Firebase</h1>
        <p>Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© Ù…Ø­Ù„ÙŠØ§Ù‹ ÙˆØ¹Ø¨Ø± Firebase Realtime</p>
        <div id="connectionStatus" style="margin-top: 10px; font-size: 14px;">
            <i class="fas fa-circle" style="color: #00ac75;"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„...
        </div>
    </header>
    
    <div class="container">
        <!-- Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
        <div class="stats-cards" id="statsCards">
            <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
        </div>
        
        <!-- Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØ­ÙƒÙ… -->
        <div class="controls">
            <div class="filters">
                <div class="filter-group">
                    <label for="searchInput"><i class="fas fa-search"></i> Ø§Ù„Ø¨Ø­Ø« Ø¨Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©</label>
                    <input type="text" id="searchInput" class="filter-input" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©...">
                </div>
                
                <div class="filter-group">
                    <label for="dateFilter"><i class="fas fa-calendar"></i> Ø§Ù„ØªØµÙÙŠØ© Ø¨Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
                    <select id="dateFilter" class="filter-input">
                        <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®</option>
                        <option value="today">Ø§Ù„ÙŠÙˆÙ…</option>
                        <option value="week">Ø¢Ø®Ø± Ø£Ø³Ø¨ÙˆØ¹</option>
                        <option value="month">Ø¢Ø®Ø± Ø´Ù‡Ø±</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="sortBy"><i class="fas fa-sort"></i> Ø§Ù„ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨</label>
                    <select id="sortBy" class="filter-input">
                        <option value="newest">Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹</option>
                        <option value="oldest">Ø§Ù„Ø£Ù‚Ø¯Ù… Ø£ÙˆÙ„Ø§Ù‹</option>
                        <option value="id">Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="syncFilter"><i class="fas fa-cloud"></i> Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©</label>
                    <select id="syncFilter" class="filter-input">
                        <option value="all">Ø§Ù„ÙƒÙ„</option>
                        <option value="synced">ØªÙ… Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©</option>
                        <option value="pending">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©</option>
                        <option value="failed">ÙØ´Ù„Øª Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©</option>
                    </select>
                </div>
            </div>
            
            <div class="buttons">
                <button class="btn btn-primary" onclick="refreshData()">
                    <i class="fas fa-sync-alt"></i> ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                </button>
                
                <button class="btn btn-primary" onclick="syncWithFirebase()" id="syncButton">
                    <i class="fas fa-cloud-upload-alt"></i> Ù…Ø²Ø§Ù…Ù†Ø© Ù…Ø¹ Firebase
                </button>
                
                <button class="btn btn-secondary" onclick="exportToExcel()">
                    <i class="fas fa-file-excel"></i> ØªØµØ¯ÙŠØ± Ù„Ø¥ÙƒØ³Ù„
                </button>
                
                <button class="btn btn-secondary" onclick="exportToJSON()">
                    <i class="fas fa-file-code"></i> ØªØµØ¯ÙŠØ± Ù„Ù€ JSON
                </button>
                
                <button class="btn btn-danger" onclick="clearData()">
                    <i class="fas fa-trash-alt"></i> Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                </button>
            </div>
            
            <!-- Ù‚Ø³Ù… Ø¥Ø¶Ø§ÙØ© Ø±Ù‚Ù… ÙˆØ§Ø­Ø¯ Ù„Ø¥Ø±Ø³Ø§Ù„Ù‡ Ø¥Ù„Ù‰ ØµÙØ­Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© -->
            <div class="add-number-section">
                <h3 style="color: #333; margin-bottom: 15px; font-size: 18px;">
                    <i class="fas fa-key"></i> Ø¥Ø±Ø³Ø§Ù„ Ø±Ù‚Ù… Ù„ØµÙØ­Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© (Firebase Realtime)
                </h3>
                
                <div class="row" style="display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 10px;">
                    <div class="col-md-10" style="flex: 1; min-width: 200px;">
                        <label for="authNumber" style="display: block; margin-bottom: 8px; color: #555; font-weight: 600;">
                            <i class="fas fa-hashtag"></i> Ø§Ù„Ø±Ù‚Ù… (0-99)
                        </label>
                        <input type="number" id="authNumber" class="filter-input" 
                               placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ù…Ù† 0 Ø¥Ù„Ù‰ 99" min="0" max="99" 
                               style="width: 100%;">
                    </div>
                    
                    <div class="col-md-2" style="flex: 0 0 auto; display: flex; align-items: flex-end;">
                        <button class="btn btn-primary" onclick="sendNumberToAuthPage()" 
                                style="padding: 12px 20px; width: 100%;">
                            <i class="fas fa-paper-plane"></i> Ø¥Ø±Ø³Ø§Ù„
                        </button>
                    </div>
                </div>
                
                <!-- Ø¹Ø±Ø¶ Ù…Ø¹Ø§ÙŠÙ†Ø© Ù„Ù„Ø±Ù‚Ù… -->
                <div class="number-preview" id="numberPreview">
                    <i class="fas fa-eye"></i> Ù…Ø¹Ø§ÙŠÙ†Ø©: <span id="previewNumber">0</span>
                </div>
                
                <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± Ù„Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø³Ø±ÙŠØ¹ -->
                <div style="margin-top: 15px;">
                    <input type="range" id="numberSlider" min="0" max="99" value="0" 
                           style="width: 100%; height: 25px;"
                           oninput="updateNumberFromSlider(this.value)">
                    <div style="display: flex; justify-content: space-between; margin-top: 5px; font-size: 12px; color: #666;">
                        <span>0</span>
                        <span>25</span>
                        <span>50</span>
                        <span>75</span>
                        <span>99</span>
                    </div>
                </div>
                
                <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø³Ø±ÙŠØ¹Ø© -->
                <div style="margin-top: 15px; display: flex; flex-wrap: wrap; gap: 8px; justify-content: center;">
                    <button class="btn" onclick="setNumber(97)" style="padding: 5px 10px; font-size: 12px; background: #0D98BA; color: white;">97</button>
                    <button class="btn" onclick="setNumber(45)" style="padding: 5px 10px; font-size: 12px; background: #00ac75; color: white;">45</button>
                    <button class="btn" onclick="setNumber(23)" style="padding: 5px 10px; font-size: 12px; background: #78849e; color: white;">23</button>
                    <button class="btn" onclick="setNumber(68)" style="padding: 5px 10px; font-size: 12px; background: #ff6b6b; color: white;">68</button>
                    <button class="btn" onclick="setNumber(12)" style="padding: 5px 10px; font-size: 12px; background: #9c27b0; color: white;">12</button>
                    <button class="btn" onclick="setNumber(89)" style="padding: 5px 10px; font-size: 12px; background: #ff9800; color: white;">89</button>
                </div>
                
                <div id="numberStatus" style="margin-top: 10px; font-size: 14px; color: #666; text-align: center;"></div>
                
                <div class="info-box" style="background: #e3f2fd; padding: 10px; border-radius: 5px; margin-top: 10px; font-size: 13px; color: #0d47a1;">
                    <i class="fas fa-info-circle"></i> 
                    Ø³ÙŠØªÙ… Ø­ÙØ¸ Ø§Ù„Ø±Ù‚Ù… ÙÙŠ Firebase Realtime Database ÙˆØ¹Ø±Ø¶Ù‡ ÙÙŠ ØµÙØ­Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© ÙÙˆØ±Ø§Ù‹
                </div>
            </div>
        </div>
        
        <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
        <div class="data-table-container">
            <div class="table-header">
                <h2><i class="fas fa-table"></i> Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© (Firebase + Ù…Ø­Ù„ÙŠ)</h2>
                <span id="recordCount">0 Ø³Ø¬Ù„Ø§Øª</span>
            </div>
            
            <div id="tableWrapper">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th width="50">#</th>
                            <th width="150">Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©</th>
                            <th>Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª</th>
                            <th width="120">Ø­Ø§Ù„Ø© Ø§Ù„ØªØ°ÙƒØ±</th>
                            <th width="100">Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©</th>
                            <th width="120">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody id="dataTableBody">
                        <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
                    </tbody>
                </table>
            </div>
            
            <div class="no-data" id="noDataMessage" style="display: none;">
                <i class="fas fa-database"></i>
                <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø®Ø²Ù†Ø©</h3>
                <p>Ù„Ù… ÙŠØªÙ… Ø¥Ø¯Ø®Ø§Ù„ Ø£ÙŠ Ø³Ø¬Ù„Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.</p>
            </div>
        </div>
        
        <!-- Ø§Ù„ØªØ±Ù‚ÙŠÙ… Ø§Ù„ØµÙØ­Ø§Øª -->
        <div class="pagination" id="pagination" style="display: none;">
            <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
        </div>
    </div>
    
    <footer class="footer">
        <p>Â© 2025 Ù†Ø¸Ø§Ù… Ø§Ù„Ù‡ÙˆÙŠØ© Ø§Ù„Ø±Ù‚Ù…ÙŠØ© | Ù…ØªØµÙ„ Ø¨Ù€ Firebase Realtime Database</p>
        <p>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø®Ø²Ù†Ø© Ù…Ø­Ù„ÙŠØ§Ù‹ ÙˆÙ…Ø²Ø§Ù…Ù†Ø© Ù…Ø¹ Firebase</p>
    </footer>

    <script>
        // === Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø§Ù…Ø© ===
        let allRecords = [];
        let currentPage = 1;
        const recordsPerPage = 10;
        let firebaseUnsubscribe = null;
        
        // === Ø¯Ø§Ù„Ø© Ø§Ù„ØªÙ‡ÙŠØ¦Ø© ===
        function init() {
            updateConnectionStatus();
            loadRecords();
            setupRealtimeUpdates();
            setupEventListeners();
            loadSavedNumber();
        }
        
        // === ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ ===
        function updateConnectionStatus() {
            const statusElement = document.getElementById('connectionStatus');
            
            firebaseConfig.db.collection('test_connection').doc('ping').set({
                test: true,
                timestamp: new Date().toISOString()
            }).then(() => {
                statusElement.innerHTML = '<i class="fas fa-circle" style="color: #00ac75;"></i> Ù…ØªØµÙ„ Ø¨Ù€ Firebase';
            }).catch((error) => {
                statusElement.innerHTML = '<i class="fas fa-circle" style="color: #ff4757;"></i> ØºÙŠØ± Ù…ØªØµÙ„ Ø¨Ù€ Firebase (Ø§Ù„Ø¹Ù…Ù„ Ù…Ø­Ù„ÙŠØ§Ù‹)';
                console.warn('âš ï¸ Firebase ØºÙŠØ± Ù…ØªØµÙ„:', error);
            });
        }
        
        // === ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ù…Ù† Firebase ÙˆØ§Ù„Ù…Ø­Ù„ÙŠ ===
        async function loadRecords() {
            try {
                console.log('ğŸ“‚ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ù…Ù† Firebase...');
                
                // ØªØ­Ù…ÙŠÙ„ Ù…Ù† Firebase
                const snapshot = await firebaseConfig.db.collection('login_records')
                    .orderBy('createdAt', 'desc')
                    .limit(1000)
                    .get();
                
                const firebaseRecords = [];
                snapshot.forEach(doc => {
                    const data = doc.data();
                    firebaseRecords.push({
                        ...data,
                        id: doc.id,
                        firebaseId: doc.id,
                        isFirebase: true,
                        timestamp: data.createdAt ? data.createdAt.toDate().toISOString() : new Date().toISOString(),
                        syncStatus: 'synced'
                    });
                });
                
                console.log(`ğŸ“¦ ØªÙ… ØªØ­Ù…ÙŠÙ„ ${firebaseRecords.length} Ø³Ø¬Ù„ Ù…Ù† Firebase`);
                
                // ØªØ­Ù…ÙŠÙ„ Ù…Ù† localStorage
                const localRecordsJson = localStorage.getItem('uae_id_records');
                const localRecords = localRecordsJson ? JSON.parse(localRecordsJson) : [];
                
                console.log(`ğŸ’¾ ØªÙ… ØªØ­Ù…ÙŠÙ„ ${localRecords.length} Ø³Ø¬Ù„ Ù…Ø­Ù„ÙŠ`);
                
                // Ø¯Ù…Ø¬ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ù…Ø¹ Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙƒØ±Ø§Ø±
                allRecords = mergeRecords(firebaseRecords, localRecords);
                
                console.log(`ğŸ“Š Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø¨Ø¹Ø¯ Ø§Ù„Ø¯Ù…Ø¬: ${allRecords.length}`);
                
                updateStats();
                renderTable();
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ù…Ù† Firebase:', error);
                // Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ù…Ù† localStorage ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£
                const recordsJson = localStorage.getItem('uae_id_records');
                allRecords = recordsJson ? JSON.parse(recordsJson) : [];
                updateStats();
                renderTable();
            }
        }
        
        // === Ø¯Ù…Ø¬ Ø§Ù„Ø³Ø¬Ù„Ø§Øª ===
        function mergeRecords(firebaseRecords, localRecords) {
            const merged = [...firebaseRecords];
            const firebaseIds = new Set(firebaseRecords.map(r => r.firebaseId));
            
            localRecords.forEach(localRecord => {
                if (!localRecord.firebaseId || !firebaseIds.has(localRecord.firebaseId)) {
                    merged.push({
                        ...localRecord,
                        isFirebase: false,
                        syncStatus: localRecord.firebaseId ? 'synced' : 'pending'
                    });
                }
            });
            
            return merged.sort((a, b) => 
                new Date(b.timestamp) - new Date(a.timestamp)
            );
        }
        
        // === ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ===
        function updateStats() {
            const statsCards = document.getElementById('statsCards');
            
            const firebaseRecords = allRecords.filter(r => r.isFirebase);
            const localRecords = allRecords.filter(r => !r.isFirebase);
            const pendingSync = allRecords.filter(r => r.syncStatus === 'pending');
            
            const stats = {
                total: allRecords.length,
                firebase: firebaseRecords.length,
                local: localRecords.length,
                pending: pendingSync.length,
                today: getTodayRecords().length,
                uniqueIds: getUniqueIds().length
            };
            
            statsCards.innerHTML = `
                <div class="stat-card">
                    <i class="fas fa-database" style="color: #0D98BA;"></i>
                    <div class="number">${stats.total}</div>
                    <div class="label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø¬Ù„Ø§Øª</div>
                </div>
                
                <div class="stat-card">
                    <i class="fas fa-cloud" style="color: #00ac75;"></i>
                    <div class="number">${stats.firebase}</div>
                    <div class="label">Ù…Ø®Ø²Ù† ÙÙŠ Firebase</div>
                </div>
                
                <div class="stat-card">
                    <i class="fas fa-hdd" style="color: #78849e;"></i>
                    <div class="number">${stats.local}</div>
                    <div class="label">Ù…Ø­Ù„ÙŠ ÙÙ‚Ø·</div>
                </div>
                
                <div class="stat-card">
                    <i class="fas fa-sync" style="color: #ff6b6b;"></i>
                    <div class="number">${stats.pending}</div>
                    <div class="label">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©</div>
                </div>
            `;
            
            document.getElementById('recordCount').textContent = `${stats.total} Ø³Ø¬Ù„Ø§Øª (${stats.firebase} FirebaseØŒ ${stats.local} Ù…Ø­Ù„ÙŠ)`;
        }
        
        // === Ø¥Ø¹Ø¯Ø§Ø¯ ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ ===
        function setupRealtimeUpdates() {
            // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
            firebaseUnsubscribe = firebaseConfig.db.collection('login_records')
                .orderBy('createdAt', 'desc')
                .limit(1)
                .onSnapshot((snapshot) => {
                    if (!snapshot.empty) {
                        const newDoc = snapshot.docs[0];
                        const newRecord = newDoc.data();
                        const recordId = newDoc.id;
                        
                        // Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø³Ø¬Ù„ Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„
                        const exists = allRecords.some(record => 
                            record.firebaseId === recordId
                        );
                        
                        if (!exists) {
                            const formattedRecord = {
                                ...newRecord,
                                id: recordId,
                                firebaseId: recordId,
                                isFirebase: true,
                                timestamp: newRecord.createdAt ? newRecord.createdAt.toDate().toISOString() : new Date().toISOString(),
                                syncStatus: 'synced'
                            };
                            
                            allRecords.unshift(formattedRecord);
                            
                            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶
                            refreshData();
                            
                            // Ø¹Ø±Ø¶ Ø¥Ø´Ø¹Ø§Ø±
                            showNotification(`ğŸ“¥ Ø³Ø¬Ù„ Ø¬Ø¯ÙŠØ¯ Ù…Ù† Firebase: ${newRecord.idNumber}`);
                        }
                    }
                }, (error) => {
                    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª:', error);
                });
        }
        
        // === Ø¹Ø±Ø¶ Ø¥Ø´Ø¹Ø§Ø± ===
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'firebase-notification';
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-bell" style="font-size: 18px;"></i>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 5000);
        }
        
        // === ØªØµÙÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ===
        function getFilteredRecords() {
            let filtered = [...allRecords];
            
            // Ø§Ù„Ø¨Ø­Ø« Ø¨Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            if (searchTerm) {
                filtered = filtered.filter(record => 
                    record.idNumber && record.idNumber.toLowerCase().includes(searchTerm)
                );
            }
            
            // Ø§Ù„ØªØµÙÙŠØ© Ø¨Ø§Ù„ØªØ§Ø±ÙŠØ®
            const dateFilter = document.getElementById('dateFilter').value;
            if (dateFilter !== 'all') {
                const now = new Date();
                
                filtered = filtered.filter(record => {
                    const recordDate = new Date(record.timestamp);
                    
                    switch(dateFilter) {
                        case 'today':
                            return isSameDay(recordDate, now);
                        case 'week':
                            const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                            return recordDate >= weekAgo;
                        case 'month':
                            const monthAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
                            return recordDate >= monthAgo;
                        default:
                            return true;
                    }
                });
            }
            
            // Ø§Ù„ØªØµÙÙŠØ© Ø¨Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©
            const syncFilter = document.getElementById('syncFilter').value;
            if (syncFilter !== 'all') {
                filtered = filtered.filter(record => 
                    record.syncStatus === syncFilter
                );
            }
            
            // Ø§Ù„ØªØ±ØªÙŠØ¨
            const sortBy = document.getElementById('sortBy').value;
            filtered.sort((a, b) => {
                switch(sortBy) {
                    case 'newest':
                        return new Date(b.timestamp) - new Date(a.timestamp);
                    case 'oldest':
                        return new Date(a.timestamp) - new Date(b.timestamp);
                    case 'id':
                        return a.idNumber.localeCompare(b.idNumber);
                    default:
                        return 0;
                }
            });
            
            return filtered;
        }
        
        // === Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ø¯ÙˆÙ„ ===
        function renderTable() {
            const filteredRecords = getFilteredRecords();
            const tableBody = document.getElementById('dataTableBody');
            const noDataMessage = document.getElementById('noDataMessage');
            const pagination = document.getElementById('pagination');
            
            if (filteredRecords.length === 0) {
                tableBody.innerHTML = '';
                noDataMessage.style.display = 'block';
                pagination.style.display = 'none';
                return;
            }
            
            noDataMessage.style.display = 'none';
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„ØµÙØ­Ø§Øª
            const totalPages = Math.ceil(filteredRecords.length / recordsPerPage);
            const startIndex = (currentPage - 1) * recordsPerPage;
            const endIndex = Math.min(startIndex + recordsPerPage, filteredRecords.length);
            const pageRecords = filteredRecords.slice(startIndex, endIndex);
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¬Ù„Ø§Øª
            tableBody.innerHTML = pageRecords.map((record, index) => {
                const actualIndex = startIndex + index + 1;
                const date = new Date(record.timestamp);
                const formattedDate = date.toLocaleDateString('ar-SA');
                const formattedTime = date.toLocaleTimeString('ar-SA');
                
                // ØªØ­Ù„ÙŠÙ„ Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©
                const idParts = record.idNumber ? {
                    prefix: record.idNumber.substring(0, 3),
                    birthYear: record.idNumber.substring(3, 7),
                    random: record.idNumber.substring(7, 14),
                    check: record.idNumber.substring(14, 15)
                } : null;
                
                // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø±Ù‚Ù… Ù…Ù† Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ© (Ø¢Ø®Ø± Ø±Ù‚Ù…ÙŠÙ†)
                const idNumber = record.idNumber || '000000000000000';
                const extractedNumber = parseInt(idNumber.substring(idNumber.length - 2)) % 100;
                
                // Ø±Ù…Ø² Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©
                let syncIcon = 'fa-check-circle';
                let syncColor = '#00ac75';
                let syncText = 'Ù…Ø²Ø§Ù…Ù†';
                
                if (record.syncStatus === 'pending') {
                    syncIcon = 'fa-clock';
                    syncColor = '#ff9800';
                    syncText = 'Ø¨Ø§Ù†ØªØ¸Ø§Ø±';
                } else if (record.syncStatus === 'failed') {
                    syncIcon = 'fa-exclamation-circle';
                    syncColor = '#ff4757';
                    syncText = 'ÙØ´Ù„';
                }
                
                return `
                    <tr>
                        <td>${actualIndex}</td>
                        <td>
                            <div class="id-number">${record.idNumber || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
                            ${idParts ? `
                                <div style="font-size: 11px; color: #888; margin-top: 5px;">
                                    <span>Ø¨Ø§Ø¯Ø¦Ø©: ${idParts.prefix}</span> | 
                                    <span>Ø³Ù†Ø©: ${idParts.birthYear}</span>
                                </div>
                            ` : ''}
                        </td>
                        <td>
                            <div class="timestamp">
                                <i class="fas fa-calendar"></i> ${formattedDate}
                            </div>
                            <div class="timestamp" style="margin-top: 5px;">
                                <i class="fas fa-clock"></i> ${formattedTime}
                                ${record.isFirebase ? '<i class="fas fa-cloud" style="margin-right: 5px; color: #00ac75;"></i>' : '<i class="fas fa-hdd" style="margin-right: 5px; color: #78849e;"></i>'}
                            </div>
                        </td>
                        <td>
                            <span class="status ${record.rememberMe ? 'status-success' : 'status-warning'}">
                                ${record.rememberMe ? 'Ù…ÙØ¹Ù„' : 'ØºÙŠØ± Ù…ÙØ¹Ù„'}
                            </span>
                        </td>
                        <td>
                            <span class="sync-status ${record.syncStatus === 'synced' ? 'sync-synced' : record.syncStatus === 'pending' ? 'sync-pending' : 'sync-failed'}">
                                <i class="fas ${syncIcon}" style="color: ${syncColor}; margin-left: 3px;"></i>
                                ${syncText}
                            </span>
                        </td>
                        <td>
                            <button onclick="viewDetails('${record.id}')" class="btn" style="padding: 5px 10px; font-size: 12px; background: #0D98BA;">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button onclick="deleteRecord('${record.id}', ${record.isFirebase})" class="btn" style="padding: 5px 10px; font-size: 12px; background: #ff4757;">
                                <i class="fas fa-trash"></i>
                            </button>
                            <button onclick="sendRecordToAuth('${record.id}', ${extractedNumber})" class="btn" style="padding: 5px 10px; font-size: 12px; background: #00ac75;">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
            
            // Ø¹Ø±Ø¶ Ø§Ù„ØªØ±Ù‚ÙŠÙ…
            renderPagination(totalPages);
            pagination.style.display = totalPages > 1 ? 'flex' : 'none';
        }
        
        // === Ø¹Ø±Ø¶ Ø§Ù„ØªØ±Ù‚ÙŠÙ… Ø§Ù„ØµÙØ­Ø§Øª ===
        function renderPagination(totalPages) {
            const pagination = document.getElementById('pagination');
            
            let html = '';
            
            // Ø²Ø± Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
            html += `
                <button class="page-btn" onclick="changePage(${currentPage - 1})" 
                        ${currentPage === 1 ? 'disabled style="opacity:0.5"' : ''}>
                    <i class="fas fa-chevron-right"></i>
                </button>
            `;
            
            // Ø£Ø±Ù‚Ø§Ù… Ø§Ù„ØµÙØ­Ø§Øª
            for (let i = 1; i <= totalPages; i++) {
                if (
                    i === 1 || 
                    i === totalPages || 
                    (i >= currentPage - 2 && i <= currentPage + 2)
                ) {
                    html += `
                        <button class="page-btn ${i === currentPage ? 'active' : ''}" 
                                onclick="changePage(${i})">
                            ${i}
                        </button>
                    `;
                } else if (i === currentPage - 3 || i === currentPage + 3) {
                    html += `<span style="padding: 8px 5px;">...</span>`;
                }
            }
            
            // Ø²Ø± Ø§Ù„ØµÙØ­Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©
            html += `
                <button class="page-btn" onclick="changePage(${currentPage + 1})" 
                        ${currentPage === totalPages ? 'disabled style="opacity:0.5"' : ''}>
                    <i class="fas fa-chevron-left"></i>
                </button>
            `;
            
            pagination.innerHTML = html;
        }
        
        // === ØªØºÙŠÙŠØ± Ø§Ù„ØµÙØ­Ø© ===
        function changePage(page) {
            const filteredRecords = getFilteredRecords();
            const totalPages = Math.ceil(filteredRecords.length / recordsPerPage);
            
            if (page < 1 || page > totalPages) return;
            
            currentPage = page;
            renderTable();
        }
        
        // === Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„ ===
        function viewDetails(recordId) {
            const record = allRecords.find(r => r.id === recordId);
            if (!record) {
                alert('âŒ Ø§Ù„Ø³Ø¬Ù„ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
                return;
            }
            
            const details = `
                ğŸ“‹ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„:
                
                ğŸ”¢ Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©: ${record.idNumber}
                ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®: ${new Date(record.timestamp).toLocaleDateString('ar-SA')}
                â° Ø§Ù„ÙˆÙ‚Øª: ${new Date(record.timestamp).toLocaleTimeString('ar-SA')}
                ğŸ’¾ Ø­Ø§Ù„Ø© Ø§Ù„ØªØ°ÙƒØ±: ${record.rememberMe ? 'Ù…ÙØ¹Ù„ âœ“' : 'ØºÙŠØ± Ù…ÙØ¹Ù„ âœ—'}
                
                ğŸŒ Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©: ${record.isFirebase ? 'Firebase âœ“' : 'Ù…Ø­Ù„ÙŠ ÙÙ‚Ø·'}
                ğŸ”„ Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©: ${record.syncStatus || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}
                
                ğŸ’» Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¬Ù‡Ø§Ø²:
                - Ø§Ù„Ù…ØªØµÙØ­: ${record.userAgent ? record.userAgent.substring(0, 50) + '...' : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}
                - Ø¯Ù‚Ø© Ø§Ù„Ø´Ø§Ø´Ø©: ${record.screenSize || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}
                - IP: ${record.ipAddress || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}
                
                ğŸ“Š Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©:
                - Ù…Ø¹Ø±Ù Ø§Ù„Ø³Ø¬Ù„: ${record.id}
                - Ù…Ø¹Ø±Ù Firebase: ${record.firebaseId || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯'}
                - Ø§Ù„Ù…ØµØ¯Ø±: ${record.source || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}
            `;
            
            alert(details);
        }
        
        // === Ø­Ø°Ù Ø³Ø¬Ù„ ===
        async function deleteRecord(recordId, isFirebase) {
            if (!confirm('âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¬Ù„ØŸ')) return;
            
            try {
                if (isFirebase) {
                    // Ø­Ø°Ù Ù…Ù† Firebase
                    await firebaseConfig.db.collection('login_records').doc(recordId).delete();
                    console.log(`ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù Ø§Ù„Ø³Ø¬Ù„ ${recordId} Ù…Ù† Firebase`);
                }
                
                // Ø­Ø°Ù Ù…Ø­Ù„ÙŠØ§Ù‹
                allRecords = allRecords.filter(record => record.id !== recordId);
                
                // ØªØ­Ø¯ÙŠØ« localStorage
                const localRecords = allRecords.filter(record => !record.isFirebase);
                localStorage.setItem('uae_id_records', JSON.stringify(localRecords));
                
                refreshData();
                showNotification('âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ø³Ø¬Ù„ Ø¨Ù†Ø¬Ø§Ø­');
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø³Ø¬Ù„:', error);
                alert('âŒ ÙØ´Ù„ Ø­Ø°Ù Ø§Ù„Ø³Ø¬Ù„ Ù…Ù† Firebase');
            }
        }
        
        // === Ø¯Ø§Ù„Ø© Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ù‚Ù… Ø¥Ù„Ù‰ ØµÙØ­Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ø¹Ø¨Ø± Firebase ===
        async function sendNumberToAuthPage() {
            const numberInput = document.getElementById('authNumber');
            const number = numberInput.value;
            const statusDiv = document.getElementById('numberStatus');
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª
            if (number === '') {
                statusDiv.innerHTML = '<span style="color: #f44336;"><i class="fas fa-exclamation-circle"></i> Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù…</span>';
                return;
            }
            
            const num = parseInt(number);
            
            if (isNaN(num) || num < 0 || num > 99) {
                statusDiv.innerHTML = '<span style="color: #f44336;"><i class="fas fa-exclamation-circle"></i> Ø§Ù„Ø±Ù‚Ù… ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø¨ÙŠÙ† 0 Ùˆ 99</span>';
                return;
            }
            
            // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø±Ù‚Ù… Ù„ÙŠØ¸Ù‡Ø± Ø¨Ø±Ù‚Ù…ÙŠÙ† (Ù…Ø«Ø§Ù„: 5 â†’ 05)
            const formattedNumber = num < 10 ? '0' + num : num.toString();
            
            try {
                statusDiv.innerHTML = '<span style="color: #2196f3;"><i class="fas fa-cloud-upload-alt"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸ ÙÙŠ Firebase...</span>';
                
                // ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø±Ù‚Ù… ÙÙŠ Firebase Realtime Database
                await firebaseConfig.realtimeDb.ref('current_auth_number').set({
                    number: num,
                    formattedNumber: formattedNumber,
                    timestamp: new Date().toISOString(),
                    source: 'manual_input',
                    fromPage: 'view-data'
                });
                
                // Ø£ÙŠØ¶Ù‹Ø§ Ø­ÙØ¸ ÙÙŠ localStorage Ù„Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ
                localStorage.setItem('auth_passcode_number', JSON.stringify({
                    number: num,
                    formattedNumber: formattedNumber,
                    timestamp: new Date().toISOString(),
                    source: 'manual_input_firebase'
                }));
                
                // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­
                statusDiv.innerHTML = `
                    <span style="color: #4caf50;">
                        <i class="fas fa-check-circle"></i> ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø±Ù‚Ù… ÙÙŠ Firebase Realtime!
                    </span>
                    <div style="margin-top: 5px; font-size: 13px;">
                        Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø­ÙÙˆØ¸: <strong>${formattedNumber}</strong>
                    </div>
                `;
                
                // Ø¹Ø±Ø¶ Ù…Ø¹Ø§ÙŠÙ†Ø© Ù„Ù„Ø±Ù‚Ù…
                const preview = document.getElementById('numberPreview');
                document.getElementById('previewNumber').textContent = formattedNumber;
                preview.classList.add('show');
                
                // ÙØªØ­ ØµÙØ­Ø© success.html ÙÙŠ Ù†Ø§ÙØ°Ø© Ø¬Ø¯ÙŠØ¯Ø© Ø¨Ø¹Ø¯ 1.5 Ø«Ø§Ù†ÙŠØ©
                setTimeout(() => {
                    window.open('success.html', '_blank');
                }, 1500);
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø±Ù‚Ù… ÙÙŠ Firebase:', error);
                statusDiv.innerHTML = `
                    <span style="color: #f44336;">
                        <i class="fas fa-exclamation-circle"></i> ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸ ÙÙŠ Firebase
                    </span>
                    <div style="margin-top: 5px; font-size: 13px;">
                        Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸ Ù…Ø­Ù„ÙŠØ§Ù‹...
                    </div>
                `;
                
                // Ø­ÙØ¸ Ù…Ø­Ù„ÙŠ ÙƒÙ†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
                localStorage.setItem('auth_passcode_number', JSON.stringify({
                    number: num,
                    formattedNumber: formattedNumber,
                    timestamp: new Date().toISOString(),
                    source: 'local_fallback'
                }));
                
                setTimeout(() => {
                    window.open('success.html', '_blank');
                }, 1500);
            }
        }
        
        // === Ø¯Ø§Ù„Ø© Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø­ÙÙˆØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ===
        async function loadSavedNumber() {
            try {
                // Ø£ÙˆÙ„Ø§Ù‹ ØªØ­Ù‚Ù‚ Ù…Ù† Firebase Realtime
                const snapshot = await firebaseConfig.realtimeDb.ref('current_auth_number').once('value');
                const firebaseNumber = snapshot.val();
                
                if (firebaseNumber) {
                    document.getElementById('authNumber').value = firebaseNumber.number || '';
                    document.getElementById('numberSlider').value = firebaseNumber.number || 0;
                    
                    const statusDiv = document.getElementById('numberStatus');
                    statusDiv.innerHTML = `
                        <span style="color: #2196f3;">
                            <i class="fas fa-cloud"></i> Ø§Ù„Ø±Ù‚Ù… Ù…Ù† Firebase: ${firebaseNumber.formattedNumber}
                            (ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«: ${new Date(firebaseNumber.timestamp).toLocaleTimeString('ar-SA')})
                        </span>
                    `;
                    
                    // Ø¹Ø±Ø¶ Ù…Ø¹Ø§ÙŠÙ†Ø©
                    const preview = document.getElementById('numberPreview');
                    document.getElementById('previewNumber').textContent = firebaseNumber.formattedNumber;
                    preview.classList.add('show');
                    
                    // Ø£ÙŠØ¶Ù‹Ø§ Ø­ÙØ¸ ÙÙŠ localStorage
                    localStorage.setItem('auth_passcode_number', JSON.stringify(firebaseNumber));
                    
                } else {
                    // ØªØ­Ù‚Ù‚ Ù…Ù† localStorage
                    const savedNumber = localStorage.getItem('auth_passcode_number');
                    if (savedNumber) {
                        const numberData = JSON.parse(savedNumber);
                        document.getElementById('authNumber').value = numberData.number || '';
                        document.getElementById('numberSlider').value = numberData.number || 0;
                        
                        const statusDiv = document.getElementById('numberStatus');
                        statusDiv.innerHTML = `
                            <span style="color: #2196f3;">
                                <i class="fas fa-history"></i> Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø­ÙÙˆØ¸ Ù…Ø­Ù„ÙŠØ§Ù‹: ${numberData.formattedNumber}
                                (ØªÙ… Ø§Ù„Ø­ÙØ¸: ${new Date(numberData.timestamp).toLocaleTimeString('ar-SA')})
                            </span>
                        `;
                        
                        // Ø¹Ø±Ø¶ Ù…Ø¹Ø§ÙŠÙ†Ø©
                        const preview = document.getElementById('numberPreview');
                        document.getElementById('previewNumber').textContent = numberData.formattedNumber;
                        preview.classList.add('show');
                    }
                }
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø­ÙÙˆØ¸:', error);
                
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… localStorage ÙÙ‚Ø· ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£
                const savedNumber = localStorage.getItem('auth_passcode_number');
                if (savedNumber) {
                    const numberData = JSON.parse(savedNumber);
                    document.getElementById('authNumber').value = numberData.number || '';
                    document.getElementById('numberSlider').value = numberData.number || 0;
                }
            }
        }
        
        // === Ø¯Ø§Ù„Ø© Ù„Ø¥Ø±Ø³Ø§Ù„ Ø³Ø¬Ù„ Ø¥Ù„Ù‰ ØµÙØ­Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© ===
        async function sendRecordToAuth(recordId, extractedNumber) {
            const record = allRecords.find(r => r.id === recordId);
            if (!record) {
                alert('âŒ Ø§Ù„Ø³Ø¬Ù„ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
                return;
            }
            
            // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø±Ù‚Ù… Ù„ÙŠØ¸Ù‡Ø± Ø¨Ø±Ù‚Ù…ÙŠÙ†
            const formattedNumber = extractedNumber < 10 ? '0' + extractedNumber : extractedNumber.toString();
            
            try {
                // Ø­ÙØ¸ ÙÙŠ Firebase Realtime
                await firebaseConfig.realtimeDb.ref('current_auth_number').set({
                    number: extractedNumber,
                    formattedNumber: formattedNumber,
                    timestamp: new Date().toISOString(),
                    source: 'record_extraction',
                    recordId: recordId,
                    idNumber: record.idNumber,
                    fromPage: 'view-data'
                });
                
                // Ø­ÙØ¸ Ù…Ø­Ù„ÙŠØ§Ù‹
                localStorage.setItem('auth_passcode_number', JSON.stringify({
                    number: extractedNumber,
                    formattedNumber: formattedNumber,
                    timestamp: new Date().toISOString(),
                    source: 'record_extraction'
                }));
                
                // Ø¹Ø±Ø¶ Ø§Ù„Ø±Ù‚Ù… ÙÙŠ Ø­Ù‚Ù„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
                document.getElementById('authNumber').value = extractedNumber;
                document.getElementById('numberSlider').value = extractedNumber;
                
                // Ø¹Ø±Ø¶ Ù…Ø¹Ø§ÙŠÙ†Ø©
                const preview = document.getElementById('numberPreview');
                document.getElementById('previewNumber').textContent = formattedNumber;
                preview.classList.add('show');
                
                // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­
                const statusDiv = document.getElementById('numberStatus');
                statusDiv.innerHTML = `
                    <span style="color: #4caf50;">
                        <i class="fas fa-check-circle"></i> ØªÙ… Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø±Ù‚Ù… ÙˆØ­ÙØ¸Ù‡ ÙÙŠ Firebase!
                    </span>
                    <div style="margin-top: 5px; font-size: 13px;">
                        Ø§Ù„Ø±Ù‚Ù…: <strong>${formattedNumber}</strong>
                    </div>
                `;
                
                showNotification(`âœ… ØªÙ… Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø±Ù‚Ù… ${formattedNumber} Ù…Ù† Ø³Ø¬Ù„ Ø§Ù„Ù‡ÙˆÙŠØ©`);
                
                // ÙØªØ­ ØµÙØ­Ø© success.html Ø¨Ø¹Ø¯ 1 Ø«Ø§Ù†ÙŠØ©
                setTimeout(() => {
                    window.open('success.html', '_blank');
                }, 1000);
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø±Ù‚Ù… ÙÙŠ Firebase:', error);
                
                // Ø­ÙØ¸ Ù…Ø­Ù„ÙŠ ÙƒÙ†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
                localStorage.setItem('auth_passcode_number', JSON.stringify({
                    number: extractedNumber,
                    formattedNumber: formattedNumber,
                    timestamp: new Date().toISOString(),
                    source: 'local_extraction'
                }));
                
                alert(`âœ… ØªÙ… Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø±Ù‚Ù… Ù…Ø­Ù„ÙŠØ§Ù‹: ${formattedNumber}`);
                
                setTimeout(() => {
                    window.open('success.html', '_blank');
                }, 1000);
            }
        }
        
        // === Ù…Ø²Ø§Ù…Ù†Ø© Ù…Ø¹ Firebase ===
        window.syncWithFirebase = async function() {
            const syncButton = document.getElementById('syncButton');
            const originalText = syncButton.innerHTML;
            const originalHTML = syncButton.innerHTML;
            
            try {
                syncButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©...';
                syncButton.disabled = true;
                
                const pendingRecords = allRecords.filter(record => 
                    record.syncStatus === 'pending' || !record.firebaseId
                );
                
                let syncedCount = 0;
                let failedCount = 0;
                
                for (const record of pendingRecords) {
                    try {
                        const recordData = {
                            idNumber: record.idNumber,
                            rememberMe: record.rememberMe,
                            timestamp: record.timestamp,
                            userAgent: record.userAgent,
                            screenSize: record.screenSize,
                            browser: record.browser || {},
                            ipAddress: record.ipAddress || 'unknown',
                            status: 'active',
                            source: record.source || 'manual_sync',
                            syncTime: new Date().toISOString(),
                            createdAt: firebase.firestore.FieldValue.serverTimestamp()
                        };
                        
                        const docRef = await firebaseConfig.db.collection('login_records').add(recordData);
                        
                        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ù…Ø­Ù„ÙŠ
                        const index = allRecords.findIndex(r => r.id === record.id);
                        if (index !== -1) {
                            allRecords[index].firebaseId = docRef.id;
                            allRecords[index].isFirebase = true;
                            allRecords[index].syncStatus = 'synced';
                        }
                        
                        syncedCount++;
                        
                        // ØªØ­Ø¯ÙŠØ« localStorage
                        const localRecords = allRecords.filter(r => !r.isFirebase);
                        localStorage.setItem('uae_id_records', JSON.stringify(localRecords));
                        
                    } catch (error) {
                        console.error(`âŒ Ø®Ø·Ø£ ÙÙŠ Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø³Ø¬Ù„ ${record.id}:`, error);
                        failedCount++;
                        
                        const index = allRecords.findIndex(r => r.id === record.id);
                        if (index !== -1) {
                            allRecords[index].syncStatus = 'failed';
                        }
                    }
                }
                
                refreshData();
                
                if (syncedCount > 0) {
                    showNotification(`âœ… ØªÙ… Ù…Ø²Ø§Ù…Ù†Ø© ${syncedCount} Ø³Ø¬Ù„ Ù…Ø¹ Firebase`);
                }
                
                if (failedCount > 0) {
                    showNotification(`âš ï¸ ÙØ´Ù„ Ù…Ø²Ø§Ù…Ù†Ø© ${failedCount} Ø³Ø¬Ù„`);
                }
                
                if (syncedCount === 0 && failedCount === 0) {
                    showNotification('â„¹ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„Ù…Ø²Ø§Ù…Ù†Ø©');
                }
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©:', error);
                showNotification('âŒ ÙØ´Ù„Øª Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ù…Ø¹ Firebase');
            } finally {
                syncButton.innerHTML = originalHTML;
                syncButton.disabled = false;
            }
        };
        
        // === Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø±Ù‚Ù… ===
        function setNumber(num) {
            if (num >= 0 && num <= 99) {
                document.getElementById('authNumber').value = num;
                document.getElementById('numberSlider').value = num;
                updateNumberPreview(num);
            }
        }
        
        function updateNumberFromSlider(value) {
            const num = parseInt(value);
            document.getElementById('authNumber').value = num;
            updateNumberPreview(num);
        }
        
        function updateNumberPreview(num) {
            const formattedNumber = num < 10 ? '0' + num : num.toString();
            document.getElementById('previewNumber').textContent = formattedNumber;
            const preview = document.getElementById('numberPreview');
            preview.classList.add('show');
            
            // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„Ø­Ø§Ù„Ø©
            const statusDiv = document.getElementById('numberStatus');
            statusDiv.innerHTML = `<span style="color: #666;">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ: <strong>${formattedNumber}</strong></span>`;
        }
        
        // === ØªØµØ¯ÙŠØ± Ù„Ø¥ÙƒØ³Ù„ ===
        function exportToExcel() {
            if (allRecords.length === 0) {
                alert('âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±');
                return;
            }
            
            const headers = ['Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©', 'Ø§Ù„ØªØ§Ø±ÙŠØ®', 'Ø§Ù„ÙˆÙ‚Øª', 'Ø­Ø§Ù„Ø© Ø§Ù„ØªØ°ÙƒØ±', 'Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©', 'Ø§Ù„Ù…ØªØµÙØ­', 'Ø¯Ù‚Ø© Ø§Ù„Ø´Ø§Ø´Ø©'];
            const data = allRecords.map(record => [
                record.idNumber,
                new Date(record.timestamp).toLocaleDateString('ar-SA'),
                new Date(record.timestamp).toLocaleTimeString('ar-SA'),
                record.rememberMe ? 'Ù…ÙØ¹Ù„' : 'ØºÙŠØ± Ù…ÙØ¹Ù„',
                record.isFirebase ? 'Firebase' : 'Ù…Ø­Ù„ÙŠ',
                record.userAgent || '',
                record.screenSize || ''
            ]);
            
            const csvContent = [
                headers.join(','),
                ...data.map(row => row.join(','))
            ].join('\n');
            
            const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `uae_id_records_${new Date().toISOString().slice(0,10)}.csv`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            alert(`âœ… ØªÙ… ØªØµØ¯ÙŠØ± ${allRecords.length} Ø³Ø¬Ù„ Ø¥Ù„Ù‰ Ù…Ù„Ù CSV`);
        }
        
        // === ØªØµØ¯ÙŠØ± Ù„Ù€ JSON ===
        function exportToJSON() {
            if (allRecords.length === 0) {
                alert('âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±');
                return;
            }
            
            const data = {
                records: allRecords,
                exportDate: new Date().toISOString(),
                totalRecords: allRecords.length,
                firebaseRecords: allRecords.filter(r => r.isFirebase).length,
                localRecords: allRecords.filter(r => !r.isFirebase).length,
                systemInfo: {
                    exportedFrom: 'UAE ID System with Firebase',
                    version: '2.0'
                }
            };
            
            const jsonStr = JSON.stringify(data, null, 2);
            const blob = new Blob([jsonStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `uae_id_records_${new Date().toISOString().slice(0,10)}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            alert(`âœ… ØªÙ… ØªØµØ¯ÙŠØ± ${allRecords.length} Ø³Ø¬Ù„ Ø¥Ù„Ù‰ Ù…Ù„Ù JSON`);
        }
        
        // === Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ===
        async function clearData() {
            if (allRecords.length === 0) {
                alert('âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ù…Ø³Ø­');
                return;
            }
            
            if (confirm(`âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (${allRecords.length} Ø³Ø¬Ù„)ØŸ\n\nÙ‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡!`)) {
                try {
                    // Ø­Ø°Ù Ù…Ù† Firebase
                    const firebaseRecords = allRecords.filter(r => r.isFirebase);
                    for (const record of firebaseRecords) {
                        if (record.firebaseId) {
                            await firebaseConfig.db.collection('login_records').doc(record.firebaseId).delete();
                        }
                    }
                    
                    // Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
                    localStorage.removeItem('uae_id_records');
                    allRecords = [];
                    
                    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
                    refreshData();
                    
                    showNotification('âœ… ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
                    
                } catch (error) {
                    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Firebase:', error);
                    alert('âŒ ÙØ´Ù„ Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† FirebaseØŒ ØªÙ… Ø§Ù„Ù…Ø³Ø­ Ù…Ø­Ù„ÙŠØ§Ù‹ ÙÙ‚Ø·');
                    
                    // Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ© ÙÙ‚Ø·
                    localStorage.removeItem('uae_id_records');
                    allRecords = [];
                    refreshData();
                }
            }
        }
        
        // === ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ===
        function refreshData() {
            loadRecords();
            currentPage = 1;
        }
        
        // === Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© ===
        function getTodayRecords() {
            const today = new Date();
            return allRecords.filter(record => 
                isSameDay(new Date(record.timestamp), today)
            );
        }
        
        function getWeekRecords() {
            const weekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);
            return allRecords.filter(record => 
                new Date(record.timestamp) >= weekAgo
            );
        }
        
        function getMonthRecords() {
            const monthAgo = new Date(Date.now() - 30 * 24 * 60 * 60 * 1000);
            return allRecords.filter(record => 
                new Date(record.timestamp) >= monthAgo
            );
        }
        
        function getUniqueIds() {
            const ids = new Set();
            allRecords.forEach(record => {
                if (record.idNumber) ids.add(record.idNumber);
            });
            return Array.from(ids);
        }
        
        function isSameDay(date1, date2) {
            return date1.getDate() === date2.getDate() &&
                   date1.getMonth() === date2.getMonth() &&
                   date1.getFullYear() === date2.getFullYear();
        }
        
        // === Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø³ØªÙ…Ø¹ÙŠÙ† Ù„Ù„Ø£Ø­Ø¯Ø§Ø« ===
        function setupEventListeners() {
            document.getElementById('searchInput').addEventListener('input', () => {
                currentPage = 1;
                renderTable();
            });
            
            document.getElementById('dateFilter').addEventListener('change', () => {
                currentPage = 1;
                renderTable();
            });
            
            document.getElementById('sortBy').addEventListener('change', () => {
                currentPage = 1;
                renderTable();
            });
            
            document.getElementById('syncFilter').addEventListener('change', () => {
                currentPage = 1;
                renderTable();
            });
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ù‚Ù… Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ±Ù‡
            document.getElementById('authNumber').addEventListener('input', function() {
                let value = parseInt(this.value);
                if (isNaN(value)) {
                    value = 0;
                } else if (value < 0) {
                    value = 0;
                    this.value = 0;
                } else if (value > 99) {
                    value = 99;
                    this.value = 99;
                }
                document.getElementById('numberSlider').value = value;
                updateNumberPreview(value);
            });
            
            // Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Enter ÙÙŠ Ø­Ù‚Ù„ Ø§Ù„Ø±Ù‚Ù…
            document.getElementById('authNumber').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendNumberToAuthPage();
                }
            });
        }
        
        // === ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© ===
        window.addEventListener('DOMContentLoaded', init);
        
        // === Ø¯Ø§Ù„Ø© Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ§Ù†Ø§Øª ÙˆÙ‡Ù…ÙŠØ© ===
        window.addTestData = function(count = 5) {
            const testIds = [
                '784199012345678', '784199512345679', '784200012345670',
                '784200512345671', '784201012345672', '784201512345673'
            ];
            
            for (let i = 0; i < Math.min(count, testIds.length); i++) {
                const record = {
                    id: 'test_' + Date.now() + '_' + i,
                    idNumber: testIds[i],
                    rememberMe: Math.random() > 0.5,
                    timestamp: new Date(Date.now() - i * 24 * 60 * 60 * 1000).toISOString(),
                    userAgent: navigator.userAgent,
                    screenSize: `${window.screen.width}x${window.screen.height}`,
                    status: 'test_data',
                    syncStatus: 'pending',
                    isFirebase: false
                };
                
                allRecords.push(record);
            }
            
            // Ø­ÙØ¸ Ù…Ø­Ù„ÙŠØ§Ù‹
            const localRecords = allRecords.filter(r => !r.isFirebase);
            localStorage.setItem('uae_id_records', JSON.stringify(localRecords));
            
            refreshData();
            alert(`âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© ${Math.min(count, testIds.length)} Ø³Ø¬Ù„ ØªØ¬Ø±ÙŠØ¨ÙŠ Ù…Ø­Ù„ÙŠ`);
        };
        
        // === Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© ===
        window.showBackups = function() {
            const backups = [];
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('uae_id_backup_')) {
                    try {
                        const backup = JSON.parse(localStorage.getItem(key));
                        backups.push({ key, ...backup });
                    } catch (e) {}
                }
            }
            
            if (backups.length === 0) {
                alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©');
                return;
            }
            
            const backupInfo = backups.map((b, index) => 
                `${index + 1}. ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ø³Ø®: ${new Date(b.backupDate).toLocaleString('ar-SA')}\n   Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø¬Ù„Ø§Øª: ${b.totalRecords}\n   Ø§Ù„Ù…ÙØªØ§Ø­: ${b.key}`
            ).join('\n\n');
            
            alert(`ğŸ“¦ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©:\n\n${backupInfo}`);
        };
        
        // === ØªÙ†Ø¸ÙŠÙ Ø¹Ù†Ø¯ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØµÙØ­Ø© ===
        window.addEventListener('beforeunload', function() {
            if (firebaseUnsubscribe) {
                firebaseUnsubscribe();
            }
        });
        
    </script>
</body>
</html>
