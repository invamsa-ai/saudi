<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ø§ØªØµØ§Ù„ Firebase</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            text-align: center;
        }
        .status {
            padding: 20px;
            margin: 20px;
            border-radius: 10px;
            font-size: 18px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .details {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
            text-align: left;
            font-family: monospace;
            font-size: 14px;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>ğŸ”¥ Ø§Ø®ØªØ¨Ø§Ø± Ø§ØªØµØ§Ù„ Firebase</h1>
    <div id="status" class="status warning">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„...</div>
    <button onclick="runTest()" style="padding: 10px 20px; font-size: 16px;">ØªØ´ØºÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</button>
    
    <div id="details" class="details" style="display: none;">
        <!-- Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
    </div>
    
    <!-- ØªØ­Ù…ÙŠÙ„ Firebase SDKs Ø¨Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„ØµØ­ÙŠØ­ -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <!-- ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Ø§Ù„ØªÙ‡ÙŠØ¦Ø© -->
    <script src="firebase-config.js"></script>
    
    <script>
        async function runTest() {
            const statusDiv = document.getElementById('status');
            const detailsDiv = document.getElementById('details');
            
            statusDiv.className = 'status warning';
            statusDiv.innerHTML = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„...';
            detailsDiv.style.display = 'none';
            
            try {
                console.log('=== Ø¨Ø¯Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Firebase ===');
                
                // 1. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ­Ù…ÙŠÙ„ Firebase SDK
                if (typeof firebase === 'undefined') {
                    throw new Error('Firebase SDK ØºÙŠØ± Ù…Ø­Ù…Ù„. ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ØªØµØ§Ù„ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª.');
                }
                
                console.log('âœ… Firebase SDK Ù…Ø­Ù…Ù„');
                
                // 2. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø¯Ø§Ù„Ø©
                if (typeof checkFirebaseConnection !== 'function') {
                    throw new Error('Ø¯Ø§Ù„Ø© checkFirebaseConnection ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©. ØªØ£ÙƒØ¯ Ù…Ù† ØªØ­Ù…ÙŠÙ„ firebase-config.js');
                }
                
                console.log('âœ… Ø¯Ø§Ù„Ø© checkFirebaseConnection Ù…ÙˆØ¬ÙˆØ¯Ø©');
                
                // 3. ØªØ´ØºÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
                const result = await checkFirebaseConnection();
                
                // 4. Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø©
                if (result.connected) {
                    statusDiv.className = 'status success';
                    statusDiv.innerHTML = `
                        âœ… <strong>ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Firebase Ø¨Ù†Ø¬Ø§Ø­!</strong><br>
                        Ø§Ù„Ù…Ø´Ø±ÙˆØ¹: ${result.projectId}<br>
                        Ø§Ù„Ø®Ø¯Ù…Ø§Øª:<br>
                        â€¢ Firestore: ${result.services.firestore ? 'âœ…' : 'âŒ'}<br>
                        â€¢ Realtime DB: ${result.services.realtime ? 'âœ…' : 'âŒ'}<br>
                        â€¢ Auth: ${result.services.auth ? 'âœ…' : 'âŒ'}
                    `;
                    
                    // Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„
                    detailsDiv.style.display = 'block';
                    detailsDiv.innerHTML = JSON.stringify(result, null, 2);
                    
                    // Ø§Ø®ØªØ¨Ø§Ø± Ø¥Ø¶Ø§ÙÙŠ: Ù…Ø­Ø§ÙˆÙ„Ø© Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                    if (window.firebaseDb) {
                        try {
                            const snapshot = await window.firebaseDb.collection('login_records').limit(5).get();
                            const count = snapshot.size;
                            detailsDiv.innerHTML += `\n\nğŸ“Š Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø¬Ù„Ø§Øª ÙÙŠ login_records: ${count}`;
                        } catch (readError) {
                            detailsDiv.innerHTML += `\n\nâš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ù‚Ø±Ø§Ø¡Ø© login_records: ${readError.message}`;
                        }
                    }
                    
                } else {
                    statusDiv.className = 'status error';
                    statusDiv.innerHTML = `
                        âŒ <strong>ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Firebase</strong><br>
                        Ø§Ù„Ø®Ø·Ø£: ${result.error}<br>
                        Ø§Ù„Ù…Ø´Ø±ÙˆØ¹: ${result.projectId}<br>
                        ${result.suggestion ? 'Ù†ØµÙŠØ­Ø©: ' + result.suggestion : ''}
                    `;
                    
                    detailsDiv.style.display = 'block';
                    detailsDiv.innerHTML = JSON.stringify(result, null, 2);
                }
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹:', error);
                statusDiv.className = 'status error';
                statusDiv.innerHTML = `
                    âŒ <strong>Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹</strong><br>
                    ${error.message}<br>
                    <small>Ø§ÙØªØ­ ÙˆØ­Ø¯Ø© Ø§Ù„ØªØ­ÙƒÙ… (F12) Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„ØªÙØ§ØµÙŠÙ„</small>
                `;
                
                detailsDiv.style.display = 'block';
                detailsDiv.innerHTML = error.stack || error.toString();
            }
        }
        
        // ØªØ´ØºÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(runTest, 1000);
        });
        
        // Ø¯Ø§Ù„Ø© Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ø³ÙŠØ· Ù…Ù† ÙˆØ­Ø¯Ø© Ø§Ù„ØªØ­ÙƒÙ…
        window.quickTest = async function() {
            console.log('ğŸ” Ø§Ø®ØªØ¨Ø§Ø± Ø³Ø±ÙŠØ¹...');
            if (window.firebaseDb) {
                try {
                    const test = await window.firebaseDb.collection('test').add({ test: true });
                    console.log('âœ… Ù†Ø¬Ø­ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±ØŒ Document ID:', test.id);
                    return true;
                } catch (error) {
                    console.error('âŒ ÙØ´Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±:', error);
                    return false;
                }
            } else {
                console.error('âŒ firebaseDb ØºÙŠØ± Ù…Ø¹Ø±Ù');
                return false;
            }
        };
    </script>
</body>
</html>
